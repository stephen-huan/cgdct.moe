#!/usr/bin/env bash
# script to build the site locally
set -o errexit
set -o nounset
set -o pipefail

site_dir="__site"
postprocess="src/postprocess"
filter="bin/filter"

# build site
julia --optimize=0 --color=yes --eval "using Franklin: optimize
  optimize(clear=true, prerender=true, minify=false)" 2> >(sh "$filter" >&2) &&

# post-processing
python "$postprocess" --verbose "$site_dir" &&
# don't ignore files in .gitignore
prettier --write "$site_dir" --ignore-path=.prettierignore
