<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <link href="/libs/katex/katex.min.css" rel="stylesheet" />
    <link href="/css/store/a2f85faf03c1b9159.css" rel="stylesheet" />
    <link href="/assets/favicon.svg" rel="icon" />
    <title>far: a (f)ast re-write of the Unix utility p(ar)</title>
    <meta
      content="Optimal variance text reflow for aesthetically pleasing borders."
      name="description"
    />
  </head>
  <body>
    <header>
      <div class="blog-name">
        <a href="/"><b class="font-weight-bold">Stephen</b> Huan</a>
      </div>
      <nav>
        <ul>
          <li><a class="" href="/">about</a></li>
          <li><a class="active" href="/blog/">blog</a></li>
          <li><a class="" href="/projects/">projects</a></li>
          <li><a class="" href="/publications/">publications</a></li>
          <li><a class="" href="/assets/pdf/cv.pdf">cv</a></li>
        </ul>
        <img
          alt="menu icon"
          height="32"
          id="menu-icon"
          src="/assets/hamburger.svg"
          width="32"
        />
      </nav>
    </header>
    <!-- Content appended here -->
    <div class="franklin-content">
      <h1>far: a (f)ast re-write of the Unix utility p(ar)</h1>
      <span class="post-meta"
        ><time datetime="2020-12-16">2020-12-16</time></span
      ><span class="post-tags"
        >  ·  <a href="/tag/cs/"><b>#</b> cs</a></span
      >
      <p>
        <a href="https://youtu.be/H3Agto3ZSnk">[Video]</a>
        <a href="/assets/blog/far/far.cpp">[Source Code (C++)]</a>
        <a href="/assets/blog/far/far.py">[Source Code (Python)]</a>
        <a href="https://github.com/eshrh/far.el"
          >[Source Code (Emacs Lisp) by esrh]</a
        >
      </p>
      <p>
        <a href="http://www.nicemice.net/par/"><code>par</code></a> is a
        formatting tool that inserts line breaks to make the length of each line
        less than a set number of characters, usually 79 (terminals historically
        have 80 width). Unfortunately, <code>par</code> is incredibly
        complicated and introduces random whitespace. So I made my own.
      </p>
      <p>
        For <code>far</code> to make the paragraphs look good, it minimizes the
        variance of each line. However, it's constrained to use the fewest
        number of lines possible, so it doesn't generate really short lines.
        Finally, it ignores the last line when minimizing variance and tries to
        make the last line shorter than average, because a typical paragraph
        usually looks better if the last line is shorter. To summarize,
      </p>
      <ol>
        <li><p>Minimize the variance of the lengths of each line...</p></li>
        <li>
          <p>
            ...subject to the constraint that the number of lines is smallest
          </p>
        </li>
        <li>
          <p>
            Ignore the last line, while making sure it's shorter than average
          </p>
        </li>
      </ol>
      <p>
        <code>far</code> uses dynamic programming to minimize variance. It
        tokenizes the paragraph by splitting on whitespace, and each subproblem
        in the dynamic program is a suffix of this token list. If
        <span class="katex"
          ><span class="katex-mathml"
            ><math xmlns="http://www.w3.org/1998/Math/MathML"
              ><semantics
                ><mrow><mi>X</mi></mrow
                ><annotation encoding="application/x-tex">
                  X
                </annotation></semantics
              ></math
            ></span
          ><span aria-hidden="true" class="katex-html"
            ><span class="base"
              ><span class="strut katex-efc4334bbb360ea4"></span
              ><span class="mord mathnormal katex-85eed73405d3da53"
                >X</span
              ></span
            ></span
          ></span
        >
        is a vector that represents the length of each line in a given paragraph
        with
        <span class="katex"
          ><span class="katex-mathml"
            ><math xmlns="http://www.w3.org/1998/Math/MathML"
              ><semantics
                ><mrow
                  ><mo stretchy="false">∣</mo><mi>X</mi
                  ><mo stretchy="false">∣</mo><mo>=</mo><mi>n</mi></mrow
                ><annotation encoding="application/x-tex">
                  \providecommand{\cardhelper}{ \@ifstar{\cardstar}{\cardnostar}
                  } \providecommand{\cardnostar}[1]{\lvert #1 \rvert}
                  \providecommand{\cardstar}[1]{\left \lvert #1 \right \rvert}
                  \cardhelper{X} = n
                </annotation></semantics
              ></math
            ></span
          ><span aria-hidden="true" class="katex-html"
            ><span class="base"
              ><span class="strut katex-fc02a23bcdeac7fb"></span
              ><span class="mopen">∣</span
              ><span class="mord mathnormal katex-85eed73405d3da53">X</span
              ><span class="mclose">∣</span
              ><span class="mspace katex-b9d9edcedd93f43c"></span
              ><span class="mrel">=</span
              ><span class="mspace katex-b9d9edcedd93f43c"></span></span
            ><span class="base"
              ><span class="strut katex-85c92d966084c2b4"></span
              ><span class="mord mathnormal">n</span></span
            ></span
          ></span
        >
        lines, then the variance of line lengths is defined as
      </p>
      <div class="nonumber">
        <span class="katex-display"
          ><span class="katex"
            ><span class="katex-mathml"
              ><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"
                ><semantics
                  ><mtable
                    columnalign="right left"
                    columnspacing="0em"
                    rowspacing="0.25em"
                    ><mtr
                      ><mtd
                        ><mstyle displaystyle="true" scriptlevel="0"
                          ><mrow
                            ><mi mathvariant="double-struck">V</mi
                            ><mtext>ar</mtext><mo stretchy="false">[</mo
                            ><mi>X</mi><mo stretchy="false">]</mo></mrow
                          ></mstyle
                        ></mtd
                      ><mtd
                        ><mstyle displaystyle="true" scriptlevel="0"
                          ><mrow
                            ><mrow></mrow><mo>=</mo
                            ><mi mathvariant="double-struck">E</mi
                            ><mo stretchy="false">[</mo
                            ><mo stretchy="false">(</mo><mi>X</mi><mo>−</mo
                            ><mi mathvariant="double-struck">E</mi
                            ><mo stretchy="false">[</mo><mi>X</mi
                            ><mo stretchy="false">]</mo
                            ><msup><mo stretchy="false">)</mo><mn>2</mn></msup
                            ><mo stretchy="false">]</mo><mo>=</mo
                            ><mfrac><mn>1</mn><mi>n</mi></mfrac
                            ><munder
                              ><mo>∑</mo
                              ><mrow
                                ><mi>x</mi><mo>∈</mo><mi>X</mi></mrow
                              ></munder
                            ><msup
                              ><mrow
                                ><mo fence="true">(</mo><mi>x</mi><mo>−</mo
                                ><mfrac><mn>1</mn><mi>n</mi></mfrac
                                ><munder
                                  ><mo>∑</mo
                                  ><mrow
                                    ><mi>x</mi><mo>∈</mo><mi>X</mi></mrow
                                  ></munder
                                ><mi>x</mi><mo fence="true">)</mo></mrow
                              ><mn>2</mn></msup
                            ></mrow
                          ></mstyle
                        ></mtd
                      ></mtr
                    ></mtable
                  ><annotation encoding="application/x-tex"
                    >\begin{aligned} \providecommand{\Varhelper}{
                    \@ifstar{\Varstar}{\Varnostar} }
                    \providecommand{\Varnostar}[1]{\mathbb{V}\text{ar}[#1]}
                    \providecommand{\Varstar}[1]{\mathbb{V}\text{ar}\left[#1\right]}
                    \Varhelper{X} &amp;= \providecommand{\Ehelper}{
                    \@ifstar{\Estar}{\Enostar} }
                    \providecommand{\Enostar}[1]{\mathbb{E}[#1]}
                    \providecommand{\Estar}[1]{\mathbb{E}\left[#1\right]}
                    \Ehelper{(X - \providecommand{\Ehelper}{
                    \@ifstar{\Estar}{\Enostar} }
                    \providecommand{\Enostar}[1]{\mathbb{E}[#1]}
                    \providecommand{\Estar}[1]{\mathbb{E}\left[#1\right]}
                    \Ehelper{X})^2} = \frac{1}{n} \sum_{x \in X} \left ( x -
                    \frac{1}{n} \sum_{x \in X} x \right )^2
                    \end{aligned}</annotation
                  ></semantics
                ></math
              ></span
            ><span aria-hidden="true" class="katex-html"
              ><span class="base"
                ><span class="strut katex-e905da22bc1dba57"></span
                ><span class="mord"
                  ><span class="mtable"
                    ><span class="col-align-r"
                      ><span class="vlist-t vlist-t2"
                        ><span class="vlist-r"
                          ><span class="vlist katex-7d8bd14132e2ecb2"
                            ><span class="katex-065c6c80c95aeab2"
                              ><span
                                class="pstrut katex-fde4180f80cbbe24"
                              ></span
                              ><span class="mord"
                                ><span class="mord mathbb">V</span
                                ><span class="mord text"
                                  ><span class="mord">ar</span></span
                                ><span class="mopen">[</span
                                ><span
                                  class="mord mathnormal katex-85eed73405d3da53"
                                  >X</span
                                ><span class="mclose">]</span></span
                              ></span
                            ></span
                          ><span class="vlist-s">​</span></span
                        ><span class="vlist-r"
                          ><span class="vlist katex-8b6a0c991359b86a"
                            ><span></span></span></span></span></span
                    ><span class="col-align-l"
                      ><span class="vlist-t vlist-t2"
                        ><span class="vlist-r"
                          ><span class="vlist katex-7d8bd14132e2ecb2"
                            ><span class="katex-065c6c80c95aeab2"
                              ><span
                                class="pstrut katex-fde4180f80cbbe24"
                              ></span
                              ><span class="mord"
                                ><span class="mord"></span
                                ><span
                                  class="mspace katex-b9d9edcedd93f43c"
                                ></span
                                ><span class="mrel">=</span
                                ><span
                                  class="mspace katex-b9d9edcedd93f43c"
                                ></span
                                ><span class="mord mathbb">E</span
                                ><span class="mopen">[(</span
                                ><span
                                  class="mord mathnormal katex-85eed73405d3da53"
                                  >X</span
                                ><span
                                  class="mspace katex-74dc427d3e42f308"
                                ></span
                                ><span class="mbin">−</span
                                ><span
                                  class="mspace katex-74dc427d3e42f308"
                                ></span
                                ><span class="mord mathbb">E</span
                                ><span class="mopen">[</span
                                ><span
                                  class="mord mathnormal katex-85eed73405d3da53"
                                  >X</span
                                ><span class="mclose">]</span
                                ><span class="mclose"
                                  ><span class="mclose">)</span
                                  ><span class="msupsub"
                                    ><span class="vlist-t"
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-d92824a307aa7af4"
                                          ><span class="katex-6aad141153b69237"
                                            ><span
                                              class="pstrut katex-1527d00b389b9857"
                                            ></span
                                            ><span
                                              class="sizing reset-size6 size3 mtight"
                                              ><span class="mord mtight"
                                                >2</span
                                              ></span
                                            ></span
                                          ></span
                                        ></span
                                      ></span
                                    ></span
                                  ></span
                                ><span class="mclose">]</span
                                ><span
                                  class="mspace katex-b9d9edcedd93f43c"
                                ></span
                                ><span class="mrel">=</span
                                ><span
                                  class="mspace katex-b9d9edcedd93f43c"
                                ></span
                                ><span class="mord"
                                  ><span class="mopen nulldelimiter"></span
                                  ><span class="mfrac"
                                    ><span class="vlist-t vlist-t2"
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-9a73793a40249f30"
                                          ><span class="katex-0f6908c112f43b43"
                                            ><span
                                              class="pstrut katex-3ac4c1d77ccd6fb1"
                                            ></span
                                            ><span class="mord"
                                              ><span class="mord mathnormal"
                                                >n</span
                                              ></span
                                            ></span
                                          ><span class="katex-9f7a5e28a2396138"
                                            ><span
                                              class="pstrut katex-3ac4c1d77ccd6fb1"
                                            ></span
                                            ><span
                                              class="frac-line katex-c48da9d2507298b7"
                                            ></span></span
                                          ><span class="katex-9d16fbcc9118ba6e"
                                            ><span
                                              class="pstrut katex-3ac4c1d77ccd6fb1"
                                            ></span
                                            ><span class="mord"
                                              ><span class="mord">1</span></span
                                            ></span
                                          ></span
                                        ><span class="vlist-s">​</span></span
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-72a5f3c452eee551"
                                          ><span></span></span></span></span></span
                                  ><span
                                    class="mclose nulldelimiter"
                                  ></span></span
                                ><span
                                  class="mspace katex-d9c1af4877255043"
                                ></span
                                ><span class="mop op-limits"
                                  ><span class="vlist-t vlist-t2"
                                    ><span class="vlist-r"
                                      ><span
                                        class="vlist katex-09b0c7c075e7b2f4"
                                        ><span class="katex-70157168c1ed5bfb"
                                          ><span
                                            class="pstrut katex-f4167b184d54d957"
                                          ></span
                                          ><span
                                            class="sizing reset-size6 size3 mtight"
                                            ><span class="mord mtight"
                                              ><span
                                                class="mord mathnormal mtight"
                                                >x</span
                                              ><span class="mrel mtight">∈</span
                                              ><span
                                                class="mord mathnormal mtight katex-85eed73405d3da53"
                                                >X</span
                                              ></span
                                            ></span
                                          ></span
                                        ><span class="katex-e14b4956e33f8747"
                                          ><span
                                            class="pstrut katex-f4167b184d54d957"
                                          ></span
                                          ><span
                                            ><span
                                              class="mop op-symbol large-op"
                                              >∑</span
                                            ></span
                                          ></span
                                        ></span
                                      ><span class="vlist-s">​</span></span
                                    ><span class="vlist-r"
                                      ><span
                                        class="vlist katex-7261757fac41437e"
                                        ><span></span></span></span></span></span
                                ><span
                                  class="mspace katex-d9c1af4877255043"
                                ></span
                                ><span class="minner"
                                  ><span class="minner"
                                    ><span
                                      class="mopen delimcenter katex-5ad82611a44e4c58"
                                      ><span class="delimsizing size4"
                                        >(</span
                                      ></span
                                    ><span class="mord mathnormal">x</span
                                    ><span
                                      class="mspace katex-74dc427d3e42f308"
                                    ></span
                                    ><span class="mbin">−</span
                                    ><span
                                      class="mspace katex-74dc427d3e42f308"
                                    ></span
                                    ><span class="mord"
                                      ><span class="mopen nulldelimiter"></span
                                      ><span class="mfrac"
                                        ><span class="vlist-t vlist-t2"
                                          ><span class="vlist-r"
                                            ><span
                                              class="vlist katex-9a73793a40249f30"
                                              ><span
                                                class="katex-0f6908c112f43b43"
                                                ><span
                                                  class="pstrut katex-3ac4c1d77ccd6fb1"
                                                ></span
                                                ><span class="mord"
                                                  ><span class="mord mathnormal"
                                                    >n</span
                                                  ></span
                                                ></span
                                              ><span
                                                class="katex-9f7a5e28a2396138"
                                                ><span
                                                  class="pstrut katex-3ac4c1d77ccd6fb1"
                                                ></span
                                                ><span
                                                  class="frac-line katex-c48da9d2507298b7"
                                                ></span></span
                                              ><span
                                                class="katex-9d16fbcc9118ba6e"
                                                ><span
                                                  class="pstrut katex-3ac4c1d77ccd6fb1"
                                                ></span
                                                ><span class="mord"
                                                  ><span class="mord"
                                                    >1</span
                                                  ></span
                                                ></span
                                              ></span
                                            ><span class="vlist-s"
                                              >​</span
                                            ></span
                                          ><span class="vlist-r"
                                            ><span
                                              class="vlist katex-72a5f3c452eee551"
                                              ><span></span></span></span></span></span
                                      ><span
                                        class="mclose nulldelimiter"
                                      ></span></span
                                    ><span
                                      class="mspace katex-d9c1af4877255043"
                                    ></span
                                    ><span class="mop op-limits"
                                      ><span class="vlist-t vlist-t2"
                                        ><span class="vlist-r"
                                          ><span
                                            class="vlist katex-09b0c7c075e7b2f4"
                                            ><span
                                              class="katex-70157168c1ed5bfb"
                                              ><span
                                                class="pstrut katex-f4167b184d54d957"
                                              ></span
                                              ><span
                                                class="sizing reset-size6 size3 mtight"
                                                ><span class="mord mtight"
                                                  ><span
                                                    class="mord mathnormal mtight"
                                                    >x</span
                                                  ><span class="mrel mtight"
                                                    >∈</span
                                                  ><span
                                                    class="mord mathnormal mtight katex-85eed73405d3da53"
                                                    >X</span
                                                  ></span
                                                ></span
                                              ></span
                                            ><span
                                              class="katex-e14b4956e33f8747"
                                              ><span
                                                class="pstrut katex-f4167b184d54d957"
                                              ></span
                                              ><span
                                                ><span
                                                  class="mop op-symbol large-op"
                                                  >∑</span
                                                ></span
                                              ></span
                                            ></span
                                          ><span class="vlist-s">​</span></span
                                        ><span class="vlist-r"
                                          ><span
                                            class="vlist katex-7261757fac41437e"
                                            ><span></span></span></span></span></span
                                    ><span
                                      class="mspace katex-d9c1af4877255043"
                                    ></span
                                    ><span class="mord mathnormal">x</span
                                    ><span
                                      class="mclose delimcenter katex-5ad82611a44e4c58"
                                      ><span class="delimsizing size4"
                                        >)</span
                                      ></span
                                    ></span
                                  ><span class="msupsub"
                                    ><span class="vlist-t"
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-1ad057433a4b253d"
                                          ><span class="katex-1da2b1a2b57f12bb"
                                            ><span
                                              class="pstrut katex-1527d00b389b9857"
                                            ></span
                                            ><span
                                              class="sizing reset-size6 size3 mtight"
                                              ><span class="mord mtight"
                                                >2</span
                                              ></span
                                            ></span
                                          ></span
                                        ></span
                                      ></span
                                    ></span
                                  ></span
                                ></span
                              ></span
                            ></span
                          ><span class="vlist-s">​</span></span
                        ><span class="vlist-r"
                          ><span class="vlist katex-8b6a0c991359b86a"
                            ><span></span></span></span></span></span></span></span></span></span></span
        ></span>
      </div>
      <p>
        The fewest number of lines constraint means
        <span class="katex"
          ><span class="katex-mathml"
            ><math xmlns="http://www.w3.org/1998/Math/MathML"
              ><semantics
                ><mrow><mi>n</mi></mrow
                ><annotation encoding="application/x-tex">
                  n
                </annotation></semantics
              ></math
            ></span
          ><span aria-hidden="true" class="katex-html"
            ><span class="base"
              ><span class="strut katex-85c92d966084c2b4"></span
              ><span class="mord mathnormal">n</span></span
            ></span
          ></span
        >
        is constant and so is the sum of line lengths
        <span class="katex"
          ><span class="katex-mathml"
            ><math xmlns="http://www.w3.org/1998/Math/MathML"
              ><semantics
                ><mrow
                  ><msub
                    ><mo>∑</mo><mrow><mi>x</mi><mo>∈</mo><mi>X</mi></mrow></msub
                  ><mi>x</mi></mrow
                ><annotation encoding="application/x-tex">
                  \sum_{x \in X} x
                </annotation></semantics
              ></math
            ></span
          ><span aria-hidden="true" class="katex-html"
            ><span class="base"
              ><span class="strut katex-93e7d25a53e26266"></span
              ><span class="mop"
                ><span class="mop op-symbol small-op katex-77838eb3fae025b9"
                  >∑</span
                ><span class="msupsub"
                  ><span class="vlist-t vlist-t2"
                    ><span class="vlist-r"
                      ><span class="vlist katex-8f7de690bd939872"
                        ><span class="katex-0f6be76b9d962139"
                          ><span class="pstrut katex-1527d00b389b9857"></span
                          ><span class="sizing reset-size6 size3 mtight"
                            ><span class="mord mtight"
                              ><span class="mord mathnormal mtight">x</span
                              ><span class="mrel mtight">∈</span
                              ><span
                                class="mord mathnormal mtight katex-85eed73405d3da53"
                                >X</span
                              ></span
                            ></span
                          ></span
                        ></span
                      ><span class="vlist-s">​</span></span
                    ><span class="vlist-r"
                      ><span class="vlist katex-ab096d5b4bfa2d30"
                        ><span></span></span></span></span></span></span
              ><span class="mspace katex-d9c1af4877255043"></span
              ><span class="mord mathnormal">x</span></span
            ></span
          ></span
        >
        because it is determined by two things: the characters in the tokens and
        the number of spaces introduced by merging two tokens (combining the
        words "hello" and "world" onto the same line gives "hello world", with
        an additional space). The characters stay the same, and the number of
        spaces is fixed if the number of lines is fixed. Each token starts off
        as its own line, and each merge reduces the number of lines by 1, so if
        two solutions have the same number of lines, they must have done the
        same number of merges.
      </p>
      <p>
        Thus, minimizing
        <span class="katex"
          ><span class="katex-mathml"
            ><math xmlns="http://www.w3.org/1998/Math/MathML"
              ><semantics
                ><mrow
                  ><mi mathvariant="double-struck">V</mi><mtext>ar</mtext
                  ><mo stretchy="false">[</mo><mi>X</mi
                  ><mo stretchy="false">]</mo></mrow
                ><annotation encoding="application/x-tex">
                  \providecommand{\Varhelper}{ \@ifstar{\Varstar}{\Varnostar} }
                  \providecommand{\Varnostar}[1]{\mathbb{V}\text{ar}[#1]}
                  \providecommand{\Varstar}[1]{\mathbb{V}\text{ar}\left[#1\right]}
                  \Varhelper{X}
                </annotation></semantics
              ></math
            ></span
          ><span aria-hidden="true" class="katex-html"
            ><span class="base"
              ><span class="strut katex-fc02a23bcdeac7fb"></span
              ><span class="mord mathbb">V</span
              ><span class="mord text"><span class="mord">ar</span></span
              ><span class="mopen">[</span
              ><span class="mord mathnormal katex-85eed73405d3da53">X</span
              ><span class="mclose">]</span></span
            ></span
          ></span
        >
        is equivalent to minimizing the sum of squares
        <span class="katex"
          ><span class="katex-mathml"
            ><math xmlns="http://www.w3.org/1998/Math/MathML"
              ><semantics
                ><mrow
                  ><msub
                    ><mo>∑</mo><mrow><mi>x</mi><mo>∈</mo><mi>X</mi></mrow></msub
                  ><msup><mi>x</mi><mn>2</mn></msup></mrow
                ><annotation encoding="application/x-tex">
                  \sum_{x \in X} x^2
                </annotation></semantics
              ></math
            ></span
          ><span aria-hidden="true" class="katex-html"
            ><span class="base"
              ><span class="strut katex-d3bbb0e002b4aa0e"></span
              ><span class="mop"
                ><span class="mop op-symbol small-op katex-77838eb3fae025b9"
                  >∑</span
                ><span class="msupsub"
                  ><span class="vlist-t vlist-t2"
                    ><span class="vlist-r"
                      ><span class="vlist katex-8f7de690bd939872"
                        ><span class="katex-0f6be76b9d962139"
                          ><span class="pstrut katex-1527d00b389b9857"></span
                          ><span class="sizing reset-size6 size3 mtight"
                            ><span class="mord mtight"
                              ><span class="mord mathnormal mtight">x</span
                              ><span class="mrel mtight">∈</span
                              ><span
                                class="mord mathnormal mtight katex-85eed73405d3da53"
                                >X</span
                              ></span
                            ></span
                          ></span
                        ></span
                      ><span class="vlist-s">​</span></span
                    ><span class="vlist-r"
                      ><span class="vlist katex-ab096d5b4bfa2d30"
                        ><span></span></span></span></span></span></span
              ><span class="mspace katex-d9c1af4877255043"></span
              ><span class="mord"
                ><span class="mord mathnormal">x</span
                ><span class="msupsub"
                  ><span class="vlist-t"
                    ><span class="vlist-r"
                      ><span class="vlist katex-b3aa06341d751ec2"
                        ><span class="katex-00abc151c90866a2"
                          ><span class="pstrut katex-1527d00b389b9857"></span
                          ><span class="sizing reset-size6 size3 mtight"
                            ><span class="mord mtight">2</span></span
                          ></span
                        ></span
                      ></span
                    ></span
                  ></span
                ></span
              ></span
            ></span
          ></span
        >
        if the number of lines is fixed. Recall that we are trying to minimize
        variance over the entire paragraph. The overall paragraph has some mean
        line length
        <span class="katex"
          ><span class="katex-mathml"
            ><math xmlns="http://www.w3.org/1998/Math/MathML"
              ><semantics
                ><mrow
                  ><mi>μ</mi><mo><mi mathvariant="normal">≔</mi></mo
                  ><mi mathvariant="double-struck">E</mi
                  ><mo stretchy="false">[</mo><mi>X</mi
                  ><mo stretchy="false">]</mo></mrow
                ><annotation encoding="application/x-tex">
                  \mu \coloneqq \providecommand{\Ehelper}{
                  \@ifstar{\Estar}{\Enostar} }
                  \providecommand{\Enostar}[1]{\mathbb{E}[#1]}
                  \providecommand{\Estar}[1]{\mathbb{E}\left[#1\right]}
                  \Ehelper{X}
                </annotation></semantics
              ></math
            ></span
          ><span aria-hidden="true" class="katex-html"
            ><span class="base"
              ><span class="strut katex-0b48a9ef2786725a"></span
              ><span class="mord mathnormal">μ</span
              ><span class="mspace katex-b9d9edcedd93f43c"></span
              ><span class="mrel"
                ><span class="mrel"
                  ><span class="mop katex-7c44e1f6d37440e1">:</span></span
                ><span class="mrel"
                  ><span class="mspace katex-dfc79d54c093c27e"></span></span
                ><span class="mrel">=</span></span
              ><span class="mspace katex-b9d9edcedd93f43c"></span></span
            ><span class="base"
              ><span class="strut katex-fc02a23bcdeac7fb"></span
              ><span class="mord mathbb">E</span><span class="mopen">[</span
              ><span class="mord mathnormal katex-85eed73405d3da53">X</span
              ><span class="mclose">]</span></span
            ></span
          ></span
        >. Each line will contribute
        <span class="katex"
          ><span class="katex-mathml"
            ><math xmlns="http://www.w3.org/1998/Math/MathML"
              ><semantics
                ><mrow
                  ><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><mi>μ</mi
                  ><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow
                ><annotation encoding="application/x-tex">
                  (x - \mu)^2
                </annotation></semantics
              ></math
            ></span
          ><span aria-hidden="true" class="katex-html"
            ><span class="base"
              ><span class="strut katex-fc02a23bcdeac7fb"></span
              ><span class="mopen">(</span><span class="mord mathnormal">x</span
              ><span class="mspace katex-74dc427d3e42f308"></span
              ><span class="mbin">−</span
              ><span class="mspace katex-74dc427d3e42f308"></span></span
            ><span class="base"
              ><span class="strut katex-d91866fb678685cf"></span
              ><span class="mord mathnormal">μ</span
              ><span class="mclose"
                ><span class="mclose">)</span
                ><span class="msupsub"
                  ><span class="vlist-t"
                    ><span class="vlist-r"
                      ><span class="vlist katex-b3aa06341d751ec2"
                        ><span class="katex-00abc151c90866a2"
                          ><span class="pstrut katex-1527d00b389b9857"></span
                          ><span class="sizing reset-size6 size3 mtight"
                            ><span class="mord mtight">2</span></span
                          ></span
                        ></span
                      ></span
                    ></span
                  ></span
                ></span
              ></span
            ></span
          ></span
        >
        to the overall paragraph's variance. So we want to minimize
      </p>
      <div class="nonumber">
        <span class="katex-display"
          ><span class="katex"
            ><span class="katex-mathml"
              ><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"
                ><semantics
                  ><mtable
                    columnalign="right"
                    columnspacing=""
                    rowspacing="0.25em"
                    ><mtr
                      ><mtd
                        ><mstyle displaystyle="true" scriptlevel="0"
                          ><mrow
                            ><mo stretchy="false">(</mo
                            ><msub><mi>x</mi><mn>1</mn></msub
                            ><mo>−</mo><mi>μ</mi
                            ><msup><mo stretchy="false">)</mo><mn>2</mn></msup
                            ><mo>+</mo><mo stretchy="false">(</mo
                            ><msub><mi>x</mi><mn>2</mn></msub
                            ><mo>−</mo><mi>μ</mi
                            ><msup><mo stretchy="false">)</mo><mn>2</mn></msup
                            ><mo>+</mo><mo>⋯</mo><mo>+</mo
                            ><mo stretchy="false">(</mo
                            ><msub><mi>x</mi><mi>n</mi></msub
                            ><mo>−</mo><mi>μ</mi
                            ><msup
                              ><mo stretchy="false">)</mo><mn>2</mn></msup
                            ></mrow
                          ></mstyle
                        ></mtd
                      ></mtr
                    ></mtable
                  ><annotation encoding="application/x-tex"
                    >\begin{aligned} (x_1 - \mu)^2 + (x_2 - \mu)^2 + \dotsb +
                    (x_n - \mu)^2 \end{aligned}</annotation
                  ></semantics
                ></math
              ></span
            ><span aria-hidden="true" class="katex-html"
              ><span class="base"
                ><span class="strut katex-8593ed4d817b9c4c"></span
                ><span class="mord"
                  ><span class="mtable"
                    ><span class="col-align-r"
                      ><span class="vlist-t vlist-t2"
                        ><span class="vlist-r"
                          ><span class="vlist katex-8c8487539359205b"
                            ><span class="katex-7e380ff2587b57a5"
                              ><span
                                class="pstrut katex-3ac4c1d77ccd6fb1"
                              ></span
                              ><span class="mord"
                                ><span class="mopen">(</span
                                ><span class="mord"
                                  ><span class="mord mathnormal">x</span
                                  ><span class="msupsub"
                                    ><span class="vlist-t vlist-t2"
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-419c46662ab8ba17"
                                          ><span class="katex-0d6ec2eaa2456336"
                                            ><span
                                              class="pstrut katex-1527d00b389b9857"
                                            ></span
                                            ><span
                                              class="sizing reset-size6 size3 mtight"
                                              ><span class="mord mtight"
                                                >1</span
                                              ></span
                                            ></span
                                          ></span
                                        ><span class="vlist-s">​</span></span
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-2506ec288336126a"
                                          ><span></span></span></span></span></span></span
                                ><span
                                  class="mspace katex-74dc427d3e42f308"
                                ></span
                                ><span class="mbin">−</span
                                ><span
                                  class="mspace katex-74dc427d3e42f308"
                                ></span
                                ><span class="mord mathnormal">μ</span
                                ><span class="mclose"
                                  ><span class="mclose">)</span
                                  ><span class="msupsub"
                                    ><span class="vlist-t"
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-d92824a307aa7af4"
                                          ><span class="katex-6aad141153b69237"
                                            ><span
                                              class="pstrut katex-1527d00b389b9857"
                                            ></span
                                            ><span
                                              class="sizing reset-size6 size3 mtight"
                                              ><span class="mord mtight"
                                                >2</span
                                              ></span
                                            ></span
                                          ></span
                                        ></span
                                      ></span
                                    ></span
                                  ></span
                                ><span
                                  class="mspace katex-74dc427d3e42f308"
                                ></span
                                ><span class="mbin">+</span
                                ><span
                                  class="mspace katex-74dc427d3e42f308"
                                ></span
                                ><span class="mopen">(</span
                                ><span class="mord"
                                  ><span class="mord mathnormal">x</span
                                  ><span class="msupsub"
                                    ><span class="vlist-t vlist-t2"
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-419c46662ab8ba17"
                                          ><span class="katex-0d6ec2eaa2456336"
                                            ><span
                                              class="pstrut katex-1527d00b389b9857"
                                            ></span
                                            ><span
                                              class="sizing reset-size6 size3 mtight"
                                              ><span class="mord mtight"
                                                >2</span
                                              ></span
                                            ></span
                                          ></span
                                        ><span class="vlist-s">​</span></span
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-2506ec288336126a"
                                          ><span></span></span></span></span></span></span
                                ><span
                                  class="mspace katex-74dc427d3e42f308"
                                ></span
                                ><span class="mbin">−</span
                                ><span
                                  class="mspace katex-74dc427d3e42f308"
                                ></span
                                ><span class="mord mathnormal">μ</span
                                ><span class="mclose"
                                  ><span class="mclose">)</span
                                  ><span class="msupsub"
                                    ><span class="vlist-t"
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-d92824a307aa7af4"
                                          ><span class="katex-6aad141153b69237"
                                            ><span
                                              class="pstrut katex-1527d00b389b9857"
                                            ></span
                                            ><span
                                              class="sizing reset-size6 size3 mtight"
                                              ><span class="mord mtight"
                                                >2</span
                                              ></span
                                            ></span
                                          ></span
                                        ></span
                                      ></span
                                    ></span
                                  ></span
                                ><span
                                  class="mspace katex-74dc427d3e42f308"
                                ></span
                                ><span class="mbin">+</span
                                ><span
                                  class="mspace katex-74dc427d3e42f308"
                                ></span
                                ><span class="minner">⋯</span
                                ><span
                                  class="mspace katex-74dc427d3e42f308"
                                ></span
                                ><span class="mbin">+</span
                                ><span
                                  class="mspace katex-74dc427d3e42f308"
                                ></span
                                ><span class="mopen">(</span
                                ><span class="mord"
                                  ><span class="mord mathnormal">x</span
                                  ><span class="msupsub"
                                    ><span class="vlist-t vlist-t2"
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-f4226b085e535dd9"
                                          ><span class="katex-0d6ec2eaa2456336"
                                            ><span
                                              class="pstrut katex-1527d00b389b9857"
                                            ></span
                                            ><span
                                              class="sizing reset-size6 size3 mtight"
                                              ><span
                                                class="mord mathnormal mtight"
                                                >n</span
                                              ></span
                                            ></span
                                          ></span
                                        ><span class="vlist-s">​</span></span
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-2506ec288336126a"
                                          ><span></span></span></span></span></span></span
                                ><span
                                  class="mspace katex-74dc427d3e42f308"
                                ></span
                                ><span class="mbin">−</span
                                ><span
                                  class="mspace katex-74dc427d3e42f308"
                                ></span
                                ><span class="mord mathnormal">μ</span
                                ><span class="mclose"
                                  ><span class="mclose">)</span
                                  ><span class="msupsub"
                                    ><span class="vlist-t"
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-d92824a307aa7af4"
                                          ><span class="katex-6aad141153b69237"
                                            ><span
                                              class="pstrut katex-1527d00b389b9857"
                                            ></span
                                            ><span
                                              class="sizing reset-size6 size3 mtight"
                                              ><span class="mord mtight"
                                                >2</span
                                              ></span
                                            ></span
                                          ></span
                                        ></span
                                      ></span
                                    ></span
                                  ></span
                                ></span
                              ></span
                            ></span
                          ><span class="vlist-s">​</span></span
                        ><span class="vlist-r"
                          ><span class="vlist katex-f2fa3d342cc4daee"
                            ><span></span></span></span></span></span></span></span></span></span></span
        ></span>
      </div>
      <p>
        where
        <span class="katex"
          ><span class="katex-mathml"
            ><math xmlns="http://www.w3.org/1998/Math/MathML"
              ><semantics
                ><mrow
                  ><msub><mi>x</mi><mi>i</mi></msub></mrow
                ><annotation encoding="application/x-tex">
                  x_i
                </annotation></semantics
              ></math
            ></span
          ><span aria-hidden="true" class="katex-html"
            ><span class="base"
              ><span class="strut katex-4891f18275a5744f"></span
              ><span class="mord"
                ><span class="mord mathnormal">x</span
                ><span class="msupsub"
                  ><span class="vlist-t vlist-t2"
                    ><span class="vlist-r"
                      ><span class="vlist katex-cb441605c9cc3b95"
                        ><span class="katex-0d6ec2eaa2456336"
                          ><span class="pstrut katex-1527d00b389b9857"></span
                          ><span class="sizing reset-size6 size3 mtight"
                            ><span class="mord mathnormal mtight">i</span></span
                          ></span
                        ></span
                      ><span class="vlist-s">​</span></span
                    ><span class="vlist-r"
                      ><span class="vlist katex-2506ec288336126a"
                        ><span></span></span></span></span></span></span></span></span
        ></span>
        is the length of the
        <span class="katex"
          ><span class="katex-mathml"
            ><math xmlns="http://www.w3.org/1998/Math/MathML"
              ><semantics
                ><mrow><mi>i</mi></mrow
                ><annotation encoding="application/x-tex">
                  i
                </annotation></semantics
              ></math
            ></span
          ><span aria-hidden="true" class="katex-html"
            ><span class="base"
              ><span class="strut katex-6e303fe1e23b5cc1"></span
              ><span class="mord mathnormal">i</span></span
            ></span
          ></span
        >-th line. Expanding,
      </p>
      <div class="nonumber">
        <span class="katex-display"
          ><span class="katex"
            ><span class="katex-mathml"
              ><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"
                ><semantics
                  ><mtable
                    columnalign="right"
                    columnspacing=""
                    rowspacing="0.25em"
                    ><mtr
                      ><mtd
                        ><mstyle displaystyle="true" scriptlevel="0"
                          ><mrow
                            ><mo stretchy="false">[</mo
                            ><msubsup><mi>x</mi><mn>1</mn><mn>2</mn></msubsup
                            ><mo>−</mo><mn>2</mn
                            ><msub><mi>x</mi><mn>1</mn></msub
                            ><mi>μ</mi><mo>+</mo
                            ><msup><mi>μ</mi><mn>2</mn></msup
                            ><mo stretchy="false">]</mo><mo>+</mo><mo>⋯</mo
                            ><mo>+</mo><mo stretchy="false">[</mo
                            ><msubsup><mi>x</mi><mi>n</mi><mn>2</mn></msubsup
                            ><mo>−</mo><mn>2</mn
                            ><msub><mi>x</mi><mi>n</mi></msub
                            ><mi>μ</mi><mo>+</mo
                            ><msup><mi>μ</mi><mn>2</mn></msup
                            ><mo stretchy="false">]</mo></mrow
                          ></mstyle
                        ></mtd
                      ></mtr
                    ></mtable
                  ><annotation encoding="application/x-tex"
                    >\begin{aligned} [x_1^2 - 2 x_1 \mu + \mu^2] + \dotsb +
                    [x_n^2 - 2 x_n \mu + \mu^2] \end{aligned}</annotation
                  ></semantics
                ></math
              ></span
            ><span aria-hidden="true" class="katex-html"
              ><span class="base"
                ><span class="strut katex-8593ed4d817b9c4c"></span
                ><span class="mord"
                  ><span class="mtable"
                    ><span class="col-align-r"
                      ><span class="vlist-t vlist-t2"
                        ><span class="vlist-r"
                          ><span class="vlist katex-8c8487539359205b"
                            ><span class="katex-7e380ff2587b57a5"
                              ><span
                                class="pstrut katex-3ac4c1d77ccd6fb1"
                              ></span
                              ><span class="mord"
                                ><span class="mopen">[</span
                                ><span class="mord"
                                  ><span class="mord mathnormal">x</span
                                  ><span class="msupsub"
                                    ><span class="vlist-t vlist-t2"
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-d92824a307aa7af4"
                                          ><span class="katex-ef2450be3f55fd91"
                                            ><span
                                              class="pstrut katex-1527d00b389b9857"
                                            ></span
                                            ><span
                                              class="sizing reset-size6 size3 mtight"
                                              ><span class="mord mtight"
                                                >1</span
                                              ></span
                                            ></span
                                          ><span class="katex-6aad141153b69237"
                                            ><span
                                              class="pstrut katex-1527d00b389b9857"
                                            ></span
                                            ><span
                                              class="sizing reset-size6 size3 mtight"
                                              ><span class="mord mtight"
                                                >2</span
                                              ></span
                                            ></span
                                          ></span
                                        ><span class="vlist-s">​</span></span
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-8cc0a6e221348e4a"
                                          ><span></span></span></span></span></span></span
                                ><span
                                  class="mspace katex-74dc427d3e42f308"
                                ></span
                                ><span class="mbin">−</span
                                ><span
                                  class="mspace katex-74dc427d3e42f308"
                                ></span
                                ><span class="mord">2</span
                                ><span class="mord"
                                  ><span class="mord mathnormal">x</span
                                  ><span class="msupsub"
                                    ><span class="vlist-t vlist-t2"
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-419c46662ab8ba17"
                                          ><span class="katex-0d6ec2eaa2456336"
                                            ><span
                                              class="pstrut katex-1527d00b389b9857"
                                            ></span
                                            ><span
                                              class="sizing reset-size6 size3 mtight"
                                              ><span class="mord mtight"
                                                >1</span
                                              ></span
                                            ></span
                                          ></span
                                        ><span class="vlist-s">​</span></span
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-2506ec288336126a"
                                          ><span></span></span></span></span></span></span
                                ><span class="mord mathnormal">μ</span
                                ><span
                                  class="mspace katex-74dc427d3e42f308"
                                ></span
                                ><span class="mbin">+</span
                                ><span
                                  class="mspace katex-74dc427d3e42f308"
                                ></span
                                ><span class="mord"
                                  ><span class="mord mathnormal">μ</span
                                  ><span class="msupsub"
                                    ><span class="vlist-t"
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-d92824a307aa7af4"
                                          ><span class="katex-6aad141153b69237"
                                            ><span
                                              class="pstrut katex-1527d00b389b9857"
                                            ></span
                                            ><span
                                              class="sizing reset-size6 size3 mtight"
                                              ><span class="mord mtight"
                                                >2</span
                                              ></span
                                            ></span
                                          ></span
                                        ></span
                                      ></span
                                    ></span
                                  ></span
                                ><span class="mclose">]</span
                                ><span
                                  class="mspace katex-74dc427d3e42f308"
                                ></span
                                ><span class="mbin">+</span
                                ><span
                                  class="mspace katex-74dc427d3e42f308"
                                ></span
                                ><span class="minner">⋯</span
                                ><span
                                  class="mspace katex-74dc427d3e42f308"
                                ></span
                                ><span class="mbin">+</span
                                ><span
                                  class="mspace katex-74dc427d3e42f308"
                                ></span
                                ><span class="mopen">[</span
                                ><span class="mord"
                                  ><span class="mord mathnormal">x</span
                                  ><span class="msupsub"
                                    ><span class="vlist-t vlist-t2"
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-d92824a307aa7af4"
                                          ><span class="katex-ef2450be3f55fd91"
                                            ><span
                                              class="pstrut katex-1527d00b389b9857"
                                            ></span
                                            ><span
                                              class="sizing reset-size6 size3 mtight"
                                              ><span
                                                class="mord mathnormal mtight"
                                                >n</span
                                              ></span
                                            ></span
                                          ><span class="katex-6aad141153b69237"
                                            ><span
                                              class="pstrut katex-1527d00b389b9857"
                                            ></span
                                            ><span
                                              class="sizing reset-size6 size3 mtight"
                                              ><span class="mord mtight"
                                                >2</span
                                              ></span
                                            ></span
                                          ></span
                                        ><span class="vlist-s">​</span></span
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-8cc0a6e221348e4a"
                                          ><span></span></span></span></span></span></span
                                ><span
                                  class="mspace katex-74dc427d3e42f308"
                                ></span
                                ><span class="mbin">−</span
                                ><span
                                  class="mspace katex-74dc427d3e42f308"
                                ></span
                                ><span class="mord">2</span
                                ><span class="mord"
                                  ><span class="mord mathnormal">x</span
                                  ><span class="msupsub"
                                    ><span class="vlist-t vlist-t2"
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-f4226b085e535dd9"
                                          ><span class="katex-0d6ec2eaa2456336"
                                            ><span
                                              class="pstrut katex-1527d00b389b9857"
                                            ></span
                                            ><span
                                              class="sizing reset-size6 size3 mtight"
                                              ><span
                                                class="mord mathnormal mtight"
                                                >n</span
                                              ></span
                                            ></span
                                          ></span
                                        ><span class="vlist-s">​</span></span
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-2506ec288336126a"
                                          ><span></span></span></span></span></span></span
                                ><span class="mord mathnormal">μ</span
                                ><span
                                  class="mspace katex-74dc427d3e42f308"
                                ></span
                                ><span class="mbin">+</span
                                ><span
                                  class="mspace katex-74dc427d3e42f308"
                                ></span
                                ><span class="mord"
                                  ><span class="mord mathnormal">μ</span
                                  ><span class="msupsub"
                                    ><span class="vlist-t"
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-d92824a307aa7af4"
                                          ><span class="katex-6aad141153b69237"
                                            ><span
                                              class="pstrut katex-1527d00b389b9857"
                                            ></span
                                            ><span
                                              class="sizing reset-size6 size3 mtight"
                                              ><span class="mord mtight"
                                                >2</span
                                              ></span
                                            ></span
                                          ></span
                                        ></span
                                      ></span
                                    ></span
                                  ></span
                                ><span class="mclose">]</span></span
                              ></span
                            ></span
                          ><span class="vlist-s">​</span></span
                        ><span class="vlist-r"
                          ><span class="vlist katex-f2fa3d342cc4daee"
                            ><span></span></span></span></span></span></span></span></span></span></span
        ></span>
      </div>
      <p>
        We can ignore the
        <span class="katex"
          ><span class="katex-mathml"
            ><math xmlns="http://www.w3.org/1998/Math/MathML"
              ><semantics
                ><mrow
                  ><msup><mi>μ</mi><mn>2</mn></msup></mrow
                ><annotation encoding="application/x-tex">
                  \mu^2
                </annotation></semantics
              ></math
            ></span
          ><span aria-hidden="true" class="katex-html"
            ><span class="base"
              ><span class="strut katex-e9128e0323a9ecc1"></span
              ><span class="mord"
                ><span class="mord mathnormal">μ</span
                ><span class="msupsub"
                  ><span class="vlist-t"
                    ><span class="vlist-r"
                      ><span class="vlist katex-b3aa06341d751ec2"
                        ><span class="katex-00abc151c90866a2"
                          ><span class="pstrut katex-1527d00b389b9857"></span
                          ><span class="sizing reset-size6 size3 mtight"
                            ><span class="mord mtight">2</span></span
                          ></span
                        ></span
                      ></span
                    ></span
                  ></span
                ></span
              ></span
            ></span
          ></span
        >
        terms since
        <span class="katex"
          ><span class="katex-mathml"
            ><math xmlns="http://www.w3.org/1998/Math/MathML"
              ><semantics
                ><mrow
                  ><mi>μ</mi><mo>=</mo><mfrac><mn>1</mn><mi>n</mi></mfrac
                  ><msub
                    ><mo>∑</mo><mrow><mi>x</mi><mo>∈</mo><mi>X</mi></mrow></msub
                  ><mi>x</mi></mrow
                ><annotation encoding="application/x-tex">
                  \mu = \frac{1}{n} \sum_{x \in X} x
                </annotation></semantics
              ></math
            ></span
          ><span aria-hidden="true" class="katex-html"
            ><span class="base"
              ><span class="strut katex-0b48a9ef2786725a"></span
              ><span class="mord mathnormal">μ</span
              ><span class="mspace katex-b9d9edcedd93f43c"></span
              ><span class="mrel">=</span
              ><span class="mspace katex-b9d9edcedd93f43c"></span></span
            ><span class="base"
              ><span class="strut katex-0e2c239603cc3e61"></span
              ><span class="mord"
                ><span class="mopen nulldelimiter"></span
                ><span class="mfrac"
                  ><span class="vlist-t vlist-t2"
                    ><span class="vlist-r"
                      ><span class="vlist katex-e4bf76b5344371ef"
                        ><span class="katex-aae519bbe9edfb64"
                          ><span class="pstrut katex-3ac4c1d77ccd6fb1"></span
                          ><span class="sizing reset-size6 size3 mtight"
                            ><span class="mord mtight"
                              ><span class="mord mathnormal mtight"
                                >n</span
                              ></span
                            ></span
                          ></span
                        ><span class="katex-9f7a5e28a2396138"
                          ><span class="pstrut katex-3ac4c1d77ccd6fb1"></span
                          ><span
                            class="frac-line katex-c48da9d2507298b7"
                          ></span></span
                        ><span class="katex-b6fb51ac2ad9d6ed"
                          ><span class="pstrut katex-3ac4c1d77ccd6fb1"></span
                          ><span class="sizing reset-size6 size3 mtight"
                            ><span class="mord mtight"
                              ><span class="mord mtight">1</span></span
                            ></span
                          ></span
                        ></span
                      ><span class="vlist-s">​</span></span
                    ><span class="vlist-r"
                      ><span class="vlist katex-570f3cb2019dcc4c"
                        ><span></span></span></span></span></span
                ><span class="mclose nulldelimiter"></span></span
              ><span class="mspace katex-d9c1af4877255043"></span
              ><span class="mop"
                ><span class="mop op-symbol small-op katex-77838eb3fae025b9"
                  >∑</span
                ><span class="msupsub"
                  ><span class="vlist-t vlist-t2"
                    ><span class="vlist-r"
                      ><span class="vlist katex-8f7de690bd939872"
                        ><span class="katex-0f6be76b9d962139"
                          ><span class="pstrut katex-1527d00b389b9857"></span
                          ><span class="sizing reset-size6 size3 mtight"
                            ><span class="mord mtight"
                              ><span class="mord mathnormal mtight">x</span
                              ><span class="mrel mtight">∈</span
                              ><span
                                class="mord mathnormal mtight katex-85eed73405d3da53"
                                >X</span
                              ></span
                            ></span
                          ></span
                        ></span
                      ><span class="vlist-s">​</span></span
                    ><span class="vlist-r"
                      ><span class="vlist katex-ab096d5b4bfa2d30"
                        ><span></span></span></span></span></span></span
              ><span class="mspace katex-d9c1af4877255043"></span
              ><span class="mord mathnormal">x</span></span
            ></span
          ></span
        >
        is constant from the aforementioned logic (both
        <span class="katex"
          ><span class="katex-mathml"
            ><math xmlns="http://www.w3.org/1998/Math/MathML"
              ><semantics
                ><mrow><mi>n</mi></mrow
                ><annotation encoding="application/x-tex">
                  n
                </annotation></semantics
              ></math
            ></span
          ><span aria-hidden="true" class="katex-html"
            ><span class="base"
              ><span class="strut katex-85c92d966084c2b4"></span
              ><span class="mord mathnormal">n</span></span
            ></span
          ></span
        >
        and the total number of characters is constant) and reorganize into
      </p>
      <div class="nonumber">
        <span class="katex-display"
          ><span class="katex"
            ><span class="katex-mathml"
              ><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"
                ><semantics
                  ><mtable
                    columnalign="right"
                    columnspacing=""
                    rowspacing="0.25em"
                    ><mtr
                      ><mtd
                        ><mstyle displaystyle="true" scriptlevel="0"
                          ><mrow
                            ><mo stretchy="false">[</mo
                            ><msubsup><mi>x</mi><mn>1</mn><mn>2</mn></msubsup
                            ><mo>+</mo><mo>⋯</mo><mo>+</mo
                            ><msubsup><mi>x</mi><mi>n</mi><mn>2</mn></msubsup
                            ><mo stretchy="false">]</mo><mo>−</mo><mn>2</mn
                            ><mi>μ</mi><mo stretchy="false">(</mo
                            ><msub><mi>x</mi><mn>1</mn></msub
                            ><mo>+</mo><mo>⋯</mo><mo>+</mo
                            ><msub><mi>x</mi><mi>n</mi></msub
                            ><mo stretchy="false">)</mo></mrow
                          ></mstyle
                        ></mtd
                      ></mtr
                    ></mtable
                  ><annotation encoding="application/x-tex"
                    >\begin{aligned} [x_1^2 + \dotsb + x_n^2] - 2 \mu (x_1 +
                    \dotsb + x_n) \end{aligned}</annotation
                  ></semantics
                ></math
              ></span
            ><span aria-hidden="true" class="katex-html"
              ><span class="base"
                ><span class="strut katex-8593ed4d817b9c4c"></span
                ><span class="mord"
                  ><span class="mtable"
                    ><span class="col-align-r"
                      ><span class="vlist-t vlist-t2"
                        ><span class="vlist-r"
                          ><span class="vlist katex-8c8487539359205b"
                            ><span class="katex-7e380ff2587b57a5"
                              ><span
                                class="pstrut katex-3ac4c1d77ccd6fb1"
                              ></span
                              ><span class="mord"
                                ><span class="mopen">[</span
                                ><span class="mord"
                                  ><span class="mord mathnormal">x</span
                                  ><span class="msupsub"
                                    ><span class="vlist-t vlist-t2"
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-d92824a307aa7af4"
                                          ><span class="katex-ef2450be3f55fd91"
                                            ><span
                                              class="pstrut katex-1527d00b389b9857"
                                            ></span
                                            ><span
                                              class="sizing reset-size6 size3 mtight"
                                              ><span class="mord mtight"
                                                >1</span
                                              ></span
                                            ></span
                                          ><span class="katex-6aad141153b69237"
                                            ><span
                                              class="pstrut katex-1527d00b389b9857"
                                            ></span
                                            ><span
                                              class="sizing reset-size6 size3 mtight"
                                              ><span class="mord mtight"
                                                >2</span
                                              ></span
                                            ></span
                                          ></span
                                        ><span class="vlist-s">​</span></span
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-8cc0a6e221348e4a"
                                          ><span></span></span></span></span></span></span
                                ><span
                                  class="mspace katex-74dc427d3e42f308"
                                ></span
                                ><span class="mbin">+</span
                                ><span
                                  class="mspace katex-74dc427d3e42f308"
                                ></span
                                ><span class="minner">⋯</span
                                ><span
                                  class="mspace katex-74dc427d3e42f308"
                                ></span
                                ><span class="mbin">+</span
                                ><span
                                  class="mspace katex-74dc427d3e42f308"
                                ></span
                                ><span class="mord"
                                  ><span class="mord mathnormal">x</span
                                  ><span class="msupsub"
                                    ><span class="vlist-t vlist-t2"
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-d92824a307aa7af4"
                                          ><span class="katex-ef2450be3f55fd91"
                                            ><span
                                              class="pstrut katex-1527d00b389b9857"
                                            ></span
                                            ><span
                                              class="sizing reset-size6 size3 mtight"
                                              ><span
                                                class="mord mathnormal mtight"
                                                >n</span
                                              ></span
                                            ></span
                                          ><span class="katex-6aad141153b69237"
                                            ><span
                                              class="pstrut katex-1527d00b389b9857"
                                            ></span
                                            ><span
                                              class="sizing reset-size6 size3 mtight"
                                              ><span class="mord mtight"
                                                >2</span
                                              ></span
                                            ></span
                                          ></span
                                        ><span class="vlist-s">​</span></span
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-8cc0a6e221348e4a"
                                          ><span></span></span></span></span></span></span
                                ><span class="mclose">]</span
                                ><span
                                  class="mspace katex-74dc427d3e42f308"
                                ></span
                                ><span class="mbin">−</span
                                ><span
                                  class="mspace katex-74dc427d3e42f308"
                                ></span
                                ><span class="mord">2</span
                                ><span class="mord mathnormal">μ</span
                                ><span class="mopen">(</span
                                ><span class="mord"
                                  ><span class="mord mathnormal">x</span
                                  ><span class="msupsub"
                                    ><span class="vlist-t vlist-t2"
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-419c46662ab8ba17"
                                          ><span class="katex-0d6ec2eaa2456336"
                                            ><span
                                              class="pstrut katex-1527d00b389b9857"
                                            ></span
                                            ><span
                                              class="sizing reset-size6 size3 mtight"
                                              ><span class="mord mtight"
                                                >1</span
                                              ></span
                                            ></span
                                          ></span
                                        ><span class="vlist-s">​</span></span
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-2506ec288336126a"
                                          ><span></span></span></span></span></span></span
                                ><span
                                  class="mspace katex-74dc427d3e42f308"
                                ></span
                                ><span class="mbin">+</span
                                ><span
                                  class="mspace katex-74dc427d3e42f308"
                                ></span
                                ><span class="minner">⋯</span
                                ><span
                                  class="mspace katex-74dc427d3e42f308"
                                ></span
                                ><span class="mbin">+</span
                                ><span
                                  class="mspace katex-74dc427d3e42f308"
                                ></span
                                ><span class="mord"
                                  ><span class="mord mathnormal">x</span
                                  ><span class="msupsub"
                                    ><span class="vlist-t vlist-t2"
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-f4226b085e535dd9"
                                          ><span class="katex-0d6ec2eaa2456336"
                                            ><span
                                              class="pstrut katex-1527d00b389b9857"
                                            ></span
                                            ><span
                                              class="sizing reset-size6 size3 mtight"
                                              ><span
                                                class="mord mathnormal mtight"
                                                >n</span
                                              ></span
                                            ></span
                                          ></span
                                        ><span class="vlist-s">​</span></span
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-2506ec288336126a"
                                          ><span></span></span></span></span></span></span
                                ><span class="mclose">)</span></span
                              ></span
                            ></span
                          ><span class="vlist-s">​</span></span
                        ><span class="vlist-r"
                          ><span class="vlist katex-f2fa3d342cc4daee"
                            ><span></span></span></span></span></span></span></span></span></span></span
        ></span>
      </div>
      <p>
        The last term is a constant, so minimizing the variance of the overall
        paragraph is equivalent to minimizing the variance for a suffix of the
        paragraph (both are minimizing the sum of squares). This is just the
        variance of the subproblem, so the dynamic programming is valid since
        optimal substructure holds. In practice, I skip calculating variance
        entirely and simply compute the sum of squares. I also do dynamic
        programming on the variance of each <em>prefix</em> instead of each
        suffix so it's easier to ignore the contribution of the last line.
      </p>
      <p>
        Note that the reduction could have been quickly observed by using the
        variance identity
      </p>
      <div class="nonumber">
        <span class="katex-display"
          ><span class="katex"
            ><span class="katex-mathml"
              ><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"
                ><semantics
                  ><mtable
                    columnalign="right left"
                    columnspacing="0em"
                    rowspacing="0.25em"
                    ><mtr
                      ><mtd
                        ><mstyle displaystyle="true" scriptlevel="0"
                          ><mrow
                            ><mi mathvariant="double-struck">V</mi
                            ><mtext>ar</mtext><mo stretchy="false">[</mo
                            ><mi>X</mi><mo stretchy="false">]</mo></mrow
                          ></mstyle
                        ></mtd
                      ><mtd
                        ><mstyle displaystyle="true" scriptlevel="0"
                          ><mrow
                            ><mrow></mrow><mo>=</mo
                            ><mi mathvariant="double-struck">E</mi
                            ><mo stretchy="false">[</mo
                            ><msup><mi>X</mi><mn>2</mn></msup
                            ><mo stretchy="false">]</mo><mo>−</mo
                            ><mi mathvariant="double-struck">E</mi
                            ><mo stretchy="false">[</mo><mi>X</mi
                            ><msup
                              ><mo stretchy="false">]</mo><mn>2</mn></msup
                            ></mrow
                          ></mstyle
                        ></mtd
                      ></mtr
                    ></mtable
                  ><annotation encoding="application/x-tex"
                    >\begin{aligned} \providecommand{\Varhelper}{
                    \@ifstar{\Varstar}{\Varnostar} }
                    \providecommand{\Varnostar}[1]{\mathbb{V}\text{ar}[#1]}
                    \providecommand{\Varstar}[1]{\mathbb{V}\text{ar}\left[#1\right]}
                    \Varhelper{X} &amp;= \providecommand{\Ehelper}{
                    \@ifstar{\Estar}{\Enostar} }
                    \providecommand{\Enostar}[1]{\mathbb{E}[#1]}
                    \providecommand{\Estar}[1]{\mathbb{E}\left[#1\right]}
                    \Ehelper{X^2} - \providecommand{\Ehelper}{
                    \@ifstar{\Estar}{\Enostar} }
                    \providecommand{\Enostar}[1]{\mathbb{E}[#1]}
                    \providecommand{\Estar}[1]{\mathbb{E}\left[#1\right]}
                    \Ehelper{X}^2 \end{aligned}</annotation
                  ></semantics
                ></math
              ></span
            ><span aria-hidden="true" class="katex-html"
              ><span class="base"
                ><span class="strut katex-8593ed4d817b9c4c"></span
                ><span class="mord"
                  ><span class="mtable"
                    ><span class="col-align-r"
                      ><span class="vlist-t vlist-t2"
                        ><span class="vlist-r"
                          ><span class="vlist katex-8c8487539359205b"
                            ><span class="katex-7e380ff2587b57a5"
                              ><span
                                class="pstrut katex-3ac4c1d77ccd6fb1"
                              ></span
                              ><span class="mord"
                                ><span class="mord mathbb">V</span
                                ><span class="mord text"
                                  ><span class="mord">ar</span></span
                                ><span class="mopen">[</span
                                ><span
                                  class="mord mathnormal katex-85eed73405d3da53"
                                  >X</span
                                ><span class="mclose">]</span></span
                              ></span
                            ></span
                          ><span class="vlist-s">​</span></span
                        ><span class="vlist-r"
                          ><span class="vlist katex-f2fa3d342cc4daee"
                            ><span></span></span></span></span></span
                    ><span class="col-align-l"
                      ><span class="vlist-t vlist-t2"
                        ><span class="vlist-r"
                          ><span class="vlist katex-8c8487539359205b"
                            ><span class="katex-7e380ff2587b57a5"
                              ><span
                                class="pstrut katex-3ac4c1d77ccd6fb1"
                              ></span
                              ><span class="mord"
                                ><span class="mord"></span
                                ><span
                                  class="mspace katex-b9d9edcedd93f43c"
                                ></span
                                ><span class="mrel">=</span
                                ><span
                                  class="mspace katex-b9d9edcedd93f43c"
                                ></span
                                ><span class="mord mathbb">E</span
                                ><span class="mopen">[</span
                                ><span class="mord"
                                  ><span
                                    class="mord mathnormal katex-85eed73405d3da53"
                                    >X</span
                                  ><span class="msupsub"
                                    ><span class="vlist-t"
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-d92824a307aa7af4"
                                          ><span class="katex-6aad141153b69237"
                                            ><span
                                              class="pstrut katex-1527d00b389b9857"
                                            ></span
                                            ><span
                                              class="sizing reset-size6 size3 mtight"
                                              ><span class="mord mtight"
                                                >2</span
                                              ></span
                                            ></span
                                          ></span
                                        ></span
                                      ></span
                                    ></span
                                  ></span
                                ><span class="mclose">]</span
                                ><span
                                  class="mspace katex-74dc427d3e42f308"
                                ></span
                                ><span class="mbin">−</span
                                ><span
                                  class="mspace katex-74dc427d3e42f308"
                                ></span
                                ><span class="mord mathbb">E</span
                                ><span class="mopen">[</span
                                ><span
                                  class="mord mathnormal katex-85eed73405d3da53"
                                  >X</span
                                ><span class="mclose"
                                  ><span class="mclose">]</span
                                  ><span class="msupsub"
                                    ><span class="vlist-t"
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-d92824a307aa7af4"
                                          ><span class="katex-6aad141153b69237"
                                            ><span
                                              class="pstrut katex-1527d00b389b9857"
                                            ></span
                                            ><span
                                              class="sizing reset-size6 size3 mtight"
                                              ><span class="mord mtight"
                                                >2</span
                                              ></span
                                            ></span
                                          ></span
                                        ></span
                                      ></span
                                    ></span
                                  ></span
                                ></span
                              ></span
                            ></span
                          ><span class="vlist-s">​</span></span
                        ><span class="vlist-r"
                          ><span class="vlist katex-f2fa3d342cc4daee"
                            ><span></span></span></span></span></span></span></span></span></span></span
        ></span>
      </div>
      <p>
        along with the fact that
        <span class="katex"
          ><span class="katex-mathml"
            ><math xmlns="http://www.w3.org/1998/Math/MathML"
              ><semantics
                ><mrow
                  ><mi mathvariant="double-struck">E</mi
                  ><mo stretchy="false">[</mo><mi>X</mi
                  ><mo stretchy="false">]</mo></mrow
                ><annotation encoding="application/x-tex">
                  \providecommand{\Ehelper}{ \@ifstar{\Estar}{\Enostar} }
                  \providecommand{\Enostar}[1]{\mathbb{E}[#1]}
                  \providecommand{\Estar}[1]{\mathbb{E}\left[#1\right]}
                  \Ehelper{X}
                </annotation></semantics
              ></math
            ></span
          ><span aria-hidden="true" class="katex-html"
            ><span class="base"
              ><span class="strut katex-fc02a23bcdeac7fb"></span
              ><span class="mord mathbb">E</span><span class="mopen">[</span
              ><span class="mord mathnormal katex-85eed73405d3da53">X</span
              ><span class="mclose">]</span></span
            ></span
          ></span
        >
        is constant. Indeed, we essentially repeated this derivation.
      </p>
      <p>
        That's it! The algorithm runs in
        <span class="katex"
          ><span class="katex-mathml"
            ><math xmlns="http://www.w3.org/1998/Math/MathML"
              ><semantics
                ><mrow
                  ><mi mathvariant="script">O</mi><mo stretchy="false">(</mo
                  ><mi>N</mi><mi>K</mi><mo stretchy="false">)</mo></mrow
                ><annotation encoding="application/x-tex">
                  \mathcal{O}(NK)
                </annotation></semantics
              ></math
            ></span
          ><span aria-hidden="true" class="katex-html"
            ><span class="base"
              ><span class="strut katex-fc02a23bcdeac7fb"></span
              ><span class="mord mathcal katex-41b20525125e978b">O</span
              ><span class="mopen">(</span
              ><span class="mord mathnormal katex-469634f8cda7614d">N</span
              ><span class="mord mathnormal katex-d08bd31ba88fcfc4">K</span
              ><span class="mclose">)</span></span
            ></span
          ></span
        >
        where
        <span class="katex"
          ><span class="katex-mathml"
            ><math xmlns="http://www.w3.org/1998/Math/MathML"
              ><semantics
                ><mrow><mi>N</mi></mrow
                ><annotation encoding="application/x-tex">
                  N
                </annotation></semantics
              ></math
            ></span
          ><span aria-hidden="true" class="katex-html"
            ><span class="base"
              ><span class="strut katex-efc4334bbb360ea4"></span
              ><span class="mord mathnormal katex-469634f8cda7614d"
                >N</span
              ></span
            ></span
          ></span
        >
        is the number of characters in the input text and
        <span class="katex"
          ><span class="katex-mathml"
            ><math xmlns="http://www.w3.org/1998/Math/MathML"
              ><semantics
                ><mrow><mi>K</mi></mrow
                ><annotation encoding="application/x-tex">
                  K
                </annotation></semantics
              ></math
            ></span
          ><span aria-hidden="true" class="katex-html"
            ><span class="base"
              ><span class="strut katex-efc4334bbb360ea4"></span
              ><span class="mord mathnormal katex-d08bd31ba88fcfc4"
                >K</span
              ></span
            ></span
          ></span
        >
        is the desired width. Since
        <span class="katex"
          ><span class="katex-mathml"
            ><math xmlns="http://www.w3.org/1998/Math/MathML"
              ><semantics
                ><mrow><mi>K</mi></mrow
                ><annotation encoding="application/x-tex">
                  K
                </annotation></semantics
              ></math
            ></span
          ><span aria-hidden="true" class="katex-html"
            ><span class="base"
              ><span class="strut katex-efc4334bbb360ea4"></span
              ><span class="mord mathnormal katex-d08bd31ba88fcfc4"
                >K</span
              ></span
            ></span
          ></span
        >
        is usually fixed to some small constant (79, 72, etc.), this is
        essentially linear in
        <span class="katex"
          ><span class="katex-mathml"
            ><math xmlns="http://www.w3.org/1998/Math/MathML"
              ><semantics
                ><mrow><mi>n</mi></mrow
                ><annotation encoding="application/x-tex">
                  n
                </annotation></semantics
              ></math
            ></span
          ><span aria-hidden="true" class="katex-html"
            ><span class="base"
              ><span class="strut katex-85c92d966084c2b4"></span
              ><span class="mord mathnormal">n</span></span
            ></span
          ></span
        >
        and I suspect most of the running time is bottlenecked by just I/O
        (reading the input text and printing out the formatted text). Running
        with a width of 79 on a 1 MB file with over 20,000 lines takes under 200
        milliseconds. For 100 MB, <code>fmt</code> takes around 11.9 seconds,
        <code>par</code> takes 15.7, and <code>far</code> takes 16.6. So
        <code>far</code> is slightly slower than the others, but certainly not
        enough to be noticeable for "reasonable" inputs, especially if output is
        redirected into a file rather than displayed to terminal.
      </p>
      <h2 id="examples">
        <a class="header-anchor" href="#examples">Examples</a>
      </h2>
      <p>original paragraph:</p>
      <pre><code class="plaintext hljs">xxxxx xxx xxx xxxx xxxxxxxxx xx x xxxxxxxxx x xxxx xxxx xxxxxxx xxxxxxxx xxx
xxxxxxxxx xxxxxxxx xx xx xxxxx xxxxx xxxx xx x xxxx xx xxxxxxxx xxxxxxxx xxxx
xxx xxxx xxxx xxx xxxxxxxxxxxxxxxxxxx xxxxxxxxxxxxx xxx xxxxx xx xxxx x xxxx
xxxxxxxx xxxx xxxx xx xxxxx xxxx xxxxx xxxx xxxxxxxxx xxx xxxxxxxxxxx xxxxxx
xxx xxxxxxxxx xxxx xxxx xx x xx xxxx xxx xxxx xx xxx xxx xxxxxxxxxxx xxxx xxxxx
x xxxxx xxxxxxx xxxxxxx xx xx xxxxxx xx xxxxx</code></pre>
      <p><code>fmt -w 72</code> (greedy algorithm):</p>
      <pre><code class="plaintext hljs">xxxxx xxx xxx xxxx xxxxxxxxx xx x xxxxxxxxx x xxxx xxxx xxxxxxx xxxxxxxx
xxx xxxxxxxxx xxxxxxxx xx xx xxxxx xxxxx xxxx xx x xxxx xx xxxxxxxx
xxxxxxxx xxxx xxx xxxx xxxx xxx xxxxxxxxxxxxxxxxxxx xxxxxxxxxxxxx xxx
xxxxx xx xxxx x xxxx xxxxxxxx xxxx xxxx xx xxxxx xxxx xxxxx xxxx
xxxxxxxxx xxx xxxxxxxxxxx xxxxxx xxx xxxxxxxxx xxxx xxxx xx x xx xxxx
xxx xxxx xx xxx xxx xxxxxxxxxxx xxxx xxxxx x xxxxx xxxxxxx xxxxxxx xx xx
xxxxxx xx xxxxx</code></pre>
      <p>
        Looking at the output of the greedy algorithm, because it always forms a
        line if it fits, it creates highly variable line lengths. For example,
        there are many "valleys" where a line is shorter than the lines adjacent
        to it, like lines 2 and lines 4, giving the paragraph a jagged
        appearance overall.
      </p>
      <p>
        <code>par 72</code> (with <code>PARINIT</code> set to
        <code>rTbgqR B=.,?'_A_a_@ Q=_s&gt;|</code>):
      </p>
      <pre><code class="plaintext hljs">xxxxx xxx xxx xxxx xxxxxxxxx xx x xxxxxxxxx x xxxx xxxx xxxxxxx xxxxxxxx
xxx xxxxxxxxx xxxxxxxx xx xx xxxxx xxxxx xxxx xx x xxxx xx xxxxxxxx
xxxxxxxx xxxx xxx xxxx xxxx xxx xxxxxxxxxxxxxxxxxxx xxxxxxxxxxxxx
xxx xxxxx xx xxxx x xxxx xxxxxxxx xxxx xxxx xx xxxxx xxxx xxxxx xxxx
xxxxxxxxx xxx xxxxxxxxxxx xxxxxx xxx xxxxxxxxx xxxx xxxx xx x xx xxxx
xxx xxxx xx xxx xxx xxxxxxxxxxx xxxx xxxxx x xxxxx xxxxxxx xxxxxxx xx xx
xxxxxx xx xxxxx</code></pre>
      <p>
        <code>par</code> improves on <code>fmt</code>, but still creates a
        single large valley.
      </p>
      <p><code>far 72</code>:</p>
      <pre><code class="plaintext hljs">xxxxx xxx xxx xxxx xxxxxxxxx xx x xxxxxxxxx x xxxx xxxx xxxxxxx
xxxxxxxx xxx xxxxxxxxx xxxxxxxx xx xx xxxxx xxxxx xxxx xx x xxxx
xx xxxxxxxx xxxxxxxx xxxx xxx xxxx xxxx xxx xxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxx xxx xxxxx xx xxxx x xxxx xxxxxxxx xxxx xxxx xx xxxxx
xxxx xxxxx xxxx xxxxxxxxx xxx xxxxxxxxxxx xxxxxx xxx xxxxxxxxx
xxxx xxxx xx x xx xxxx xxx xxxx xx xxx xxx xxxxxxxxxxx xxxx xxxxx
x xxxxx xxxxxxx xxxxxxx xx xx xxxxxx xx xxxxx</code></pre>
      <p>
        Finally, I would argue that <code>far</code> creates the most
        aesthetically pleasing paragraph because it minimizes the variance,
        creating the smoothest paragraph edge.
      </p>
      <p>
        It's probably possible to modify <code>PARINIT</code> for
        <code>par</code> to work properly on this example, and in general
        <code>par</code> works quite well, but it's hard to work through the
        documentation to find precisely what to do and the recommended
        <code>PARINIT</code> in the man page should work well. In contrast
        <code>far</code> works well "out of the box" and for better or for
        worse, only has a single configuration option –- the desired line width.
      </p>
      <h2 id="uses"><a class="header-anchor" href="#uses">Uses</a></h2>
      <p>
        This program is useful whenever writing plaintext in a monospace text
        editor, e.g. when editing LaTeX, markdown files, college essays, and
        emails. It's especially useful in <code>vim</code>, which lets you set
        the option <code>'formatprg'</code> so the operator
        <code>gq</code> formats using the external program.
      </p>
      <h2 id="appendix">
        <a class="header-anchor" href="#appendix">Appendix</a>
      </h2>
      <p>
        The paragraph reformatting problem can be phrased in terms of three
        different
        <a
          href="https://en.wikipedia.org/wiki/Lp_space#The_p-norm_in_finite_dimensions"
          ><span class="katex"
            ><span class="katex-mathml"
              ><math xmlns="http://www.w3.org/1998/Math/MathML"
                ><semantics
                  ><mrow
                    ><msup
                      ><mi mathvariant="normal">ℓ</mi><mi>p</mi></msup
                    ></mrow
                  ><annotation encoding="application/x-tex">
                    \ell^p
                  </annotation></semantics
                ></math
              ></span
            ><span aria-hidden="true" class="katex-html"
              ><span class="base"
                ><span class="strut katex-1443dcef7dd0be4f"></span
                ><span class="mord"
                  ><span class="mord">ℓ</span
                  ><span class="msupsub"
                    ><span class="vlist-t"
                      ><span class="vlist-r"
                        ><span class="vlist katex-8727367727c49b7f"
                          ><span class="katex-00abc151c90866a2"
                            ><span class="pstrut katex-1527d00b389b9857"></span
                            ><span class="sizing reset-size6 size3 mtight"
                              ><span class="mord mathnormal mtight"
                                >p</span
                              ></span
                            ></span
                          ></span
                        ></span
                      ></span
                    ></span
                  ></span
                ></span
              ></span
            ></span
          >-norms</a
        >.
      </p>
      <p>
        If
        <span class="katex"
          ><span class="katex-mathml"
            ><math xmlns="http://www.w3.org/1998/Math/MathML"
              ><semantics
                ><mrow><mi>X</mi></mrow
                ><annotation encoding="application/x-tex">
                  X
                </annotation></semantics
              ></math
            ></span
          ><span aria-hidden="true" class="katex-html"
            ><span class="base"
              ><span class="strut katex-efc4334bbb360ea4"></span
              ><span class="mord mathnormal katex-85eed73405d3da53"
                >X</span
              ></span
            ></span
          ></span
        >
        is a vector that represents the length of each line for a given
        paragraph, we want the every line in the paragraph to be shorter than
        <span class="katex"
          ><span class="katex-mathml"
            ><math xmlns="http://www.w3.org/1998/Math/MathML"
              ><semantics
                ><mrow><mi>K</mi></mrow
                ><annotation encoding="application/x-tex">
                  K
                </annotation></semantics
              ></math
            ></span
          ><span aria-hidden="true" class="katex-html"
            ><span class="base"
              ><span class="strut katex-efc4334bbb360ea4"></span
              ><span class="mord mathnormal katex-d08bd31ba88fcfc4"
                >K</span
              ></span
            ></span
          ></span
        >
        characters, so
        <span class="katex"
          ><span class="katex-mathml"
            ><math xmlns="http://www.w3.org/1998/Math/MathML"
              ><semantics
                ><mrow
                  ><mi>max</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>X</mi
                  ><mo stretchy="false">)</mo><mo>=</mo
                  ><mo stretchy="false">∥</mo><mi>X</mi
                  ><msub
                    ><mo stretchy="false">∥</mo
                    ><mi mathvariant="normal">∞</mi></msub
                  ><mo>≤</mo><mi>K</mi></mrow
                ><annotation encoding="application/x-tex">
                  \max(X) = \providecommand{\normhelper}{
                  \@ifstar{\normstar}{\normnostar} }
                  \providecommand{\normnostar}[1]{\lVert #1 \rVert}
                  \providecommand{\normstar}[1]{\left \lVert #1 \right \rVert}
                  \normhelper{X}_\infty \leq K
                </annotation></semantics
              ></math
            ></span
          ><span aria-hidden="true" class="katex-html"
            ><span class="base"
              ><span class="strut katex-fc02a23bcdeac7fb"></span
              ><span class="mop">max</span><span class="mopen">(</span
              ><span class="mord mathnormal katex-85eed73405d3da53">X</span
              ><span class="mclose">)</span
              ><span class="mspace katex-b9d9edcedd93f43c"></span
              ><span class="mrel">=</span
              ><span class="mspace katex-b9d9edcedd93f43c"></span></span
            ><span class="base"
              ><span class="strut katex-fc02a23bcdeac7fb"></span
              ><span class="mopen">∥</span
              ><span class="mord mathnormal katex-85eed73405d3da53">X</span
              ><span class="mclose"
                ><span class="mclose">∥</span
                ><span class="msupsub"
                  ><span class="vlist-t vlist-t2"
                    ><span class="vlist-r"
                      ><span class="vlist katex-f4226b085e535dd9"
                        ><span class="katex-0d6ec2eaa2456336"
                          ><span class="pstrut katex-1527d00b389b9857"></span
                          ><span class="sizing reset-size6 size3 mtight"
                            ><span class="mord mtight">∞</span></span
                          ></span
                        ></span
                      ><span class="vlist-s">​</span></span
                    ><span class="vlist-r"
                      ><span class="vlist katex-2506ec288336126a"
                        ><span></span></span></span></span></span></span
              ><span class="mspace katex-b9d9edcedd93f43c"></span
              ><span class="mrel">≤</span
              ><span class="mspace katex-b9d9edcedd93f43c"></span></span
            ><span class="base"
              ><span class="strut katex-efc4334bbb360ea4"></span
              ><span class="mord mathnormal katex-d08bd31ba88fcfc4"
                >K</span
              ></span
            ></span
          ></span
        >. We want to only reformat the paragraph in such a way that the number
        of lines is the shortest possible over all paragraphs
        <span class="katex"
          ><span class="katex-mathml"
            ><math xmlns="http://www.w3.org/1998/Math/MathML"
              ><semantics
                ><mrow><mi>P</mi></mrow
                ><annotation encoding="application/x-tex">
                  P
                </annotation></semantics
              ></math
            ></span
          ><span aria-hidden="true" class="katex-html"
            ><span class="base"
              ><span class="strut katex-efc4334bbb360ea4"></span
              ><span class="mord mathnormal katex-87bb948d627adca1"
                >P</span
              ></span
            ></span
          ></span
        >
        that obey the length constraint, that is,
      </p>
      <div class="nonumber">
        <span class="katex-display"
          ><span class="katex"
            ><span class="katex-mathml"
              ><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"
                ><semantics
                  ><mtable
                    columnalign="right"
                    columnspacing=""
                    rowspacing="0.25em"
                    ><mtr
                      ><mtd
                        ><mstyle displaystyle="true" scriptlevel="0"
                          ><mrow
                            ><mo stretchy="false">∥</mo><mi>X</mi
                            ><msub><mo stretchy="false">∥</mo><mn>0</mn></msub
                            ><mo>=</mo
                            ><munder
                              ><mrow><mi>min</mi><mo>⁡</mo></mrow
                              ><mrow
                                ><mi>P</mi><mo>:</mo><mtext> </mtext
                                ><mo stretchy="false">∥</mo><mi>P</mi
                                ><msub
                                  ><mo stretchy="false">∥</mo
                                  ><mi mathvariant="normal">∞</mi></msub
                                ><mo>≤</mo><mi>K</mi></mrow
                              ></munder
                            ><mtext>  </mtext><mo stretchy="false">∥</mo
                            ><mi>P</mi
                            ><msub
                              ><mo stretchy="false">∥</mo><mn>0</mn></msub
                            ></mrow
                          ></mstyle
                        ></mtd
                      ></mtr
                    ></mtable
                  ><annotation encoding="application/x-tex"
                    >\begin{aligned} \providecommand{\normhelper}{
                    \@ifstar{\normstar}{\normnostar} }
                    \providecommand{\normnostar}[1]{\lVert #1 \rVert}
                    \providecommand{\normstar}[1]{\left \lVert #1 \right \rVert}
                    \normhelper{X}_0 = \min_{P: \, \providecommand{\normhelper}{
                    \@ifstar{\normstar}{\normnostar} }
                    \providecommand{\normnostar}[1]{\lVert #1 \rVert}
                    \providecommand{\normstar}[1]{\left \lVert #1 \right \rVert}
                    \normhelper{P}_\infty \leq K} \;
                    \providecommand{\normhelper}{
                    \@ifstar{\normstar}{\normnostar} }
                    \providecommand{\normnostar}[1]{\lVert #1 \rVert}
                    \providecommand{\normstar}[1]{\left \lVert #1 \right \rVert}
                    \normhelper{P}_0 \end{aligned}</annotation
                  ></semantics
                ></math
              ></span
            ><span aria-hidden="true" class="katex-html"
              ><span class="base"
                ><span class="strut katex-8555e5bada9d4045"></span
                ><span class="mord"
                  ><span class="mtable"
                    ><span class="col-align-r"
                      ><span class="vlist-t vlist-t2"
                        ><span class="vlist-r"
                          ><span class="vlist katex-7cdbe36bec2d5f98"
                            ><span class="katex-5790254d4eb33326"
                              ><span
                                class="pstrut katex-3ac4c1d77ccd6fb1"
                              ></span
                              ><span class="mord"
                                ><span class="mopen">∥</span
                                ><span
                                  class="mord mathnormal katex-85eed73405d3da53"
                                  >X</span
                                ><span class="mclose"
                                  ><span class="mclose">∥</span
                                  ><span class="msupsub"
                                    ><span class="vlist-t vlist-t2"
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-419c46662ab8ba17"
                                          ><span class="katex-0d6ec2eaa2456336"
                                            ><span
                                              class="pstrut katex-1527d00b389b9857"
                                            ></span
                                            ><span
                                              class="sizing reset-size6 size3 mtight"
                                              ><span class="mord mtight"
                                                >0</span
                                              ></span
                                            ></span
                                          ></span
                                        ><span class="vlist-s">​</span></span
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-2506ec288336126a"
                                          ><span></span></span></span></span></span></span
                                ><span
                                  class="mspace katex-b9d9edcedd93f43c"
                                ></span
                                ><span class="mrel">=</span
                                ><span
                                  class="mspace katex-b9d9edcedd93f43c"
                                ></span
                                ><span class="mop op-limits"
                                  ><span class="vlist-t vlist-t2"
                                    ><span class="vlist-r"
                                      ><span
                                        class="vlist katex-a51f135ff03c83c9"
                                        ><span class="katex-9035900f79f10b37"
                                          ><span
                                            class="pstrut katex-3ac4c1d77ccd6fb1"
                                          ></span
                                          ><span
                                            class="sizing reset-size6 size3 mtight"
                                            ><span class="mord mtight"
                                              ><span
                                                class="mord mathnormal mtight katex-87bb948d627adca1"
                                                >P</span
                                              ><span class="mrel mtight">:</span
                                              ><span
                                                class="mspace mtight katex-c2c6ccbb9a43e8b7"
                                              ></span
                                              ><span class="mopen mtight"
                                                >∥</span
                                              ><span
                                                class="mord mathnormal mtight katex-87bb948d627adca1"
                                                >P</span
                                              ><span class="mclose mtight"
                                                ><span class="mclose mtight"
                                                  >∥</span
                                                ><span class="msupsub"
                                                  ><span
                                                    class="vlist-t vlist-t2"
                                                    ><span class="vlist-r"
                                                      ><span
                                                        class="vlist katex-6e2b124f6a733faa"
                                                        ><span
                                                          class="katex-312ee5c75ee3a006"
                                                          ><span
                                                            class="pstrut katex-30f1852ae721d9ae"
                                                          ></span
                                                          ><span
                                                            class="sizing reset-size3 size1 mtight"
                                                            ><span
                                                              class="mord mtight"
                                                              >∞</span
                                                            ></span
                                                          ></span
                                                        ></span
                                                      ><span class="vlist-s"
                                                        >​</span
                                                      ></span
                                                    ><span class="vlist-r"
                                                      ><span
                                                        class="vlist katex-698887e62561da60"
                                                        ><span></span></span></span></span></span></span
                                              ><span class="mrel mtight">≤</span
                                              ><span
                                                class="mord mathnormal mtight katex-d08bd31ba88fcfc4"
                                                >K</span
                                              ></span
                                            ></span
                                          ></span
                                        ><span class="katex-48bfdc4f0cc83b58"
                                          ><span
                                            class="pstrut katex-3ac4c1d77ccd6fb1"
                                          ></span
                                          ><span
                                            ><span class="mop">min</span></span
                                          ></span
                                        ></span
                                      ><span class="vlist-s">​</span></span
                                    ><span class="vlist-r"
                                      ><span
                                        class="vlist katex-f07783683100adc1"
                                        ><span></span></span></span></span></span
                                ><span
                                  class="mspace katex-b9d9edcedd93f43c"
                                ></span
                                ><span class="mopen">∥</span
                                ><span
                                  class="mord mathnormal katex-87bb948d627adca1"
                                  >P</span
                                ><span class="mclose"
                                  ><span class="mclose">∥</span
                                  ><span class="msupsub"
                                    ><span class="vlist-t vlist-t2"
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-419c46662ab8ba17"
                                          ><span class="katex-0d6ec2eaa2456336"
                                            ><span
                                              class="pstrut katex-1527d00b389b9857"
                                            ></span
                                            ><span
                                              class="sizing reset-size6 size3 mtight"
                                              ><span class="mord mtight"
                                                >0</span
                                              ></span
                                            ></span
                                          ></span
                                        ><span class="vlist-s">​</span></span
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-2506ec288336126a"
                                          ><span></span></span></span></span></span></span></span></span></span
                          ><span class="vlist-s">​</span></span
                        ><span class="vlist-r"
                          ><span class="vlist katex-f7336e4186829d82"
                            ><span></span></span></span></span></span></span></span></span></span></span
        ></span>
      </div>
      <p>
        where we abuse the
        <a href="https://en.wikipedia.org/wiki/Lp_space#When_p_=_0"
          ><span class="katex"
            ><span class="katex-mathml"
              ><math xmlns="http://www.w3.org/1998/Math/MathML"
                ><semantics
                  ><mrow
                    ><msup
                      ><mi mathvariant="normal">ℓ</mi><mn>0</mn></msup
                    ></mrow
                  ><annotation encoding="application/x-tex">
                    \ell^0
                  </annotation></semantics
                ></math
              ></span
            ><span aria-hidden="true" class="katex-html"
              ><span class="base"
                ><span class="strut katex-b3aa06341d751ec2"></span
                ><span class="mord"
                  ><span class="mord">ℓ</span
                  ><span class="msupsub"
                    ><span class="vlist-t"
                      ><span class="vlist-r"
                        ><span class="vlist katex-b3aa06341d751ec2"
                          ><span class="katex-00abc151c90866a2"
                            ><span class="pstrut katex-1527d00b389b9857"></span
                            ><span class="sizing reset-size6 size3 mtight"
                              ><span class="mord mtight">0</span></span
                            ></span
                          ></span
                        ></span
                      ></span
                    ></span
                  ></span
                ></span
              ></span
            ></span
          >-"norm"</a
        >. Finally, the goal of minimizing variance is equivalent to minimizing
        the
        <span class="katex"
          ><span class="katex-mathml"
            ><math xmlns="http://www.w3.org/1998/Math/MathML"
              ><semantics
                ><mrow
                  ><msup><mi mathvariant="normal">ℓ</mi><mn>2</mn></msup></mrow
                ><annotation encoding="application/x-tex">
                  \ell^2
                </annotation></semantics
              ></math
            ></span
          ><span aria-hidden="true" class="katex-html"
            ><span class="base"
              ><span class="strut katex-b3aa06341d751ec2"></span
              ><span class="mord"
                ><span class="mord">ℓ</span
                ><span class="msupsub"
                  ><span class="vlist-t"
                    ><span class="vlist-r"
                      ><span class="vlist katex-b3aa06341d751ec2"
                        ><span class="katex-00abc151c90866a2"
                          ><span class="pstrut katex-1527d00b389b9857"></span
                          ><span class="sizing reset-size6 size3 mtight"
                            ><span class="mord mtight">2</span></span
                          ></span
                        ></span
                      ></span
                    ></span
                  ></span
                ></span
              ></span
            ></span
          ></span
        >
        norm of
        <span class="katex"
          ><span class="katex-mathml"
            ><math xmlns="http://www.w3.org/1998/Math/MathML"
              ><semantics
                ><mrow><mi>X</mi></mrow
                ><annotation encoding="application/x-tex">
                  X
                </annotation></semantics
              ></math
            ></span
          ><span aria-hidden="true" class="katex-html"
            ><span class="base"
              ><span class="strut katex-efc4334bbb360ea4"></span
              ><span class="mord mathnormal katex-85eed73405d3da53"
                >X</span
              ></span
            ></span
          ></span
        >
        since the
        <span class="katex"
          ><span class="katex-mathml"
            ><math xmlns="http://www.w3.org/1998/Math/MathML"
              ><semantics
                ><mrow
                  ><msup><mi mathvariant="normal">ℓ</mi><mn>2</mn></msup></mrow
                ><annotation encoding="application/x-tex">
                  \ell^2
                </annotation></semantics
              ></math
            ></span
          ><span aria-hidden="true" class="katex-html"
            ><span class="base"
              ><span class="strut katex-b3aa06341d751ec2"></span
              ><span class="mord"
                ><span class="mord">ℓ</span
                ><span class="msupsub"
                  ><span class="vlist-t"
                    ><span class="vlist-r"
                      ><span class="vlist katex-b3aa06341d751ec2"
                        ><span class="katex-00abc151c90866a2"
                          ><span class="pstrut katex-1527d00b389b9857"></span
                          ><span class="sizing reset-size6 size3 mtight"
                            ><span class="mord mtight">2</span></span
                          ></span
                        ></span
                      ></span
                    ></span
                  ></span
                ></span
              ></span
            ></span
          ></span
        >
        norm is the sum of squares. In summary, we have the optimization problem
        taken over
        <span class="katex"
          ><span class="katex-mathml"
            ><math xmlns="http://www.w3.org/1998/Math/MathML"
              ><semantics
                ><mrow
                  ><mi mathvariant="script">P</mi
                  ><mo><mi mathvariant="normal">≔</mi></mo
                  ><mo stretchy="false">{</mo
                  ><mrow
                    ><mtext>valid paragraphs </mtext
                    ><mstyle displaystyle="false" scriptlevel="0"
                      ><mi>X</mi></mstyle
                    ><mtext> such that </mtext
                    ><mstyle displaystyle="false" scriptlevel="0"
                      ><mo stretchy="false">∥</mo><mi>X</mi
                      ><msub
                        ><mo stretchy="false">∥</mo
                        ><mi mathvariant="normal">∞</mi></msub
                      ><mo>≤</mo><mi>K</mi></mstyle
                    ></mrow
                  ><mo stretchy="false">}</mo></mrow
                ><annotation encoding="application/x-tex">
                  \mathcal{P} \coloneqq \{ \text{valid paragraphs $ X $ such
                  that $ \providecommand{\normhelper}{
                  \@ifstar{\normstar}{\normnostar} }
                  \providecommand{\normnostar}[1]{\lVert #1 \rVert}
                  \providecommand{\normstar}[1]{\left \lVert #1 \right \rVert}
                  \normhelper{X}_\infty \leq K $} \}
                </annotation></semantics
              ></math
            ></span
          ><span aria-hidden="true" class="katex-html"
            ><span class="base"
              ><span class="strut katex-efc4334bbb360ea4"></span
              ><span class="mord mathcal katex-3ead7d987ac181e8">P</span
              ><span class="mspace katex-b9d9edcedd93f43c"></span
              ><span class="mrel"
                ><span class="mrel"
                  ><span class="mop katex-7c44e1f6d37440e1">:</span></span
                ><span class="mrel"
                  ><span class="mspace katex-dfc79d54c093c27e"></span></span
                ><span class="mrel">=</span></span
              ><span class="mspace katex-b9d9edcedd93f43c"></span></span
            ><span class="base"
              ><span class="strut katex-fc02a23bcdeac7fb"></span
              ><span class="mopen">{</span
              ><span class="mord text"
                ><span class="mord">valid paragraphs </span
                ><span class="mord mathnormal katex-85eed73405d3da53">X</span
                ><span class="mord"> such that </span
                ><span class="mopen">∥</span
                ><span class="mord mathnormal katex-85eed73405d3da53">X</span
                ><span class="mclose"
                  ><span class="mclose">∥</span
                  ><span class="msupsub"
                    ><span class="vlist-t vlist-t2"
                      ><span class="vlist-r"
                        ><span class="vlist katex-f4226b085e535dd9"
                          ><span class="katex-0d6ec2eaa2456336"
                            ><span class="pstrut katex-1527d00b389b9857"></span
                            ><span class="sizing reset-size6 size3 mtight"
                              ><span class="mord mtight">∞</span></span
                            ></span
                          ></span
                        ><span class="vlist-s">​</span></span
                      ><span class="vlist-r"
                        ><span class="vlist katex-2506ec288336126a"
                          ><span></span></span></span></span></span></span
                ><span class="mspace katex-b9d9edcedd93f43c"></span
                ><span class="mrel">≤</span
                ><span class="mspace katex-b9d9edcedd93f43c"></span
                ><span class="mord mathnormal katex-d08bd31ba88fcfc4"
                  >K</span
                ></span
              ><span class="mclose">}</span></span
            ></span
          ></span
        >
        of
      </p>
      <div class="nonumber">
        <span class="katex-display"
          ><span class="katex"
            ><span class="katex-mathml"
              ><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"
                ><semantics
                  ><mtable
                    columnalign="right"
                    columnspacing=""
                    rowspacing="0.25em"
                    ><mtr
                      ><mtd
                        ><mstyle displaystyle="true" scriptlevel="0"
                          ><mrow
                            ><munder
                              ><mrow><mi>min</mi><mo>⁡</mo></mrow
                              ><mstyle scriptlevel="1"
                                ><mtable
                                  columnalign="center"
                                  columnspacing="1em"
                                  rowspacing="0.1em"
                                  ><mtr
                                    ><mtd
                                      ><mstyle
                                        displaystyle="false"
                                        scriptlevel="1"
                                        ><mrow
                                          ><mi>X</mi><mo>∈</mo
                                          ><mi mathvariant="script">P</mi></mrow
                                        ></mstyle
                                      ></mtd
                                    ></mtr
                                  ><mtr
                                    ><mtd
                                      ><mstyle
                                        displaystyle="false"
                                        scriptlevel="1"
                                        ><mrow
                                          ><mo stretchy="false">∥</mo><mi>X</mi
                                          ><msub
                                            ><mo stretchy="false">∥</mo
                                            ><mn>0</mn></msub
                                          ><mo>=</mo><mi>n</mi></mrow
                                        ></mstyle
                                      ></mtd
                                    ></mtr
                                  ></mtable
                                ></mstyle
                              ></munder
                            ><mtext>  </mtext><mo stretchy="false">∥</mo
                            ><mi>X</mi
                            ><msub
                              ><mo stretchy="false">∥</mo><mn>2</mn></msub
                            ></mrow
                          ></mstyle
                        ></mtd
                      ></mtr
                    ><mtr
                      ><mtd
                        ><mstyle displaystyle="true" scriptlevel="0"
                          ><mrow
                            ><mi>n</mi><mo>=</mo
                            ><munder
                              ><mrow><mi>min</mi><mo>⁡</mo></mrow
                              ><mrow
                                ><mi>P</mi><mo>∈</mo
                                ><mi mathvariant="script">P</mi></mrow
                              ></munder
                            ><mtext>  </mtext><mo stretchy="false">∥</mo
                            ><mi>P</mi
                            ><msub
                              ><mo stretchy="false">∥</mo><mn>0</mn></msub
                            ></mrow
                          ></mstyle
                        ></mtd
                      ></mtr
                    ></mtable
                  ><annotation encoding="application/x-tex"
                    >\begin{aligned} \min_{\substack{X \in \mathcal{P} \\
                    \providecommand{\normhelper}{
                    \@ifstar{\normstar}{\normnostar} }
                    \providecommand{\normnostar}[1]{\lVert #1 \rVert}
                    \providecommand{\normstar}[1]{\left \lVert #1 \right \rVert}
                    \normhelper{X}_0 = n}} \; \providecommand{\normhelper}{
                    \@ifstar{\normstar}{\normnostar} }
                    \providecommand{\normnostar}[1]{\lVert #1 \rVert}
                    \providecommand{\normstar}[1]{\left \lVert #1 \right \rVert}
                    \normhelper{X}_2 \\ n = \min_{P \in \mathcal{P}} \;
                    \providecommand{\normhelper}{
                    \@ifstar{\normstar}{\normnostar} }
                    \providecommand{\normnostar}[1]{\lVert #1 \rVert}
                    \providecommand{\normstar}[1]{\left \lVert #1 \right \rVert}
                    \normhelper{P}_0 \end{aligned}</annotation
                  ></semantics
                ></math
              ></span
            ><span aria-hidden="true" class="katex-html"
              ><span class="base"
                ><span class="strut katex-52d26b5dcd14028b"></span
                ><span class="mord"
                  ><span class="mtable"
                    ><span class="col-align-r"
                      ><span class="vlist-t vlist-t2"
                        ><span class="vlist-r"
                          ><span class="vlist katex-93bf9af2b075d96b"
                            ><span class="katex-de0c70bbd16de957"
                              ><span
                                class="pstrut katex-3ac4c1d77ccd6fb1"
                              ></span
                              ><span class="mord"
                                ><span class="mop op-limits"
                                  ><span class="vlist-t vlist-t2"
                                    ><span class="vlist-r"
                                      ><span
                                        class="vlist katex-a51f135ff03c83c9"
                                        ><span class="katex-171759c92bf4b431"
                                          ><span
                                            class="pstrut katex-3ac4c1d77ccd6fb1"
                                          ></span
                                          ><span
                                            class="sizing reset-size6 size3 mtight"
                                            ><span class="mord mtight"
                                              ><span class="mord mtight"
                                                ><span class="mtable"
                                                  ><span class="col-align-c"
                                                    ><span
                                                      class="vlist-t vlist-t2"
                                                      ><span class="vlist-r"
                                                        ><span
                                                          class="vlist katex-54c975a535d265c0"
                                                          ><span
                                                            class="katex-e58a58724b890ecc"
                                                            ><span
                                                              class="pstrut katex-126b25298b406a6f"
                                                            ></span
                                                            ><span
                                                              class="mord mtight"
                                                              ><span
                                                                class="mord mathnormal mtight katex-85eed73405d3da53"
                                                                >X</span
                                                              ><span
                                                                class="mrel mtight"
                                                                >∈</span
                                                              ><span
                                                                class="mord mathcal mtight katex-3ead7d987ac181e8"
                                                                >P</span
                                                              ></span
                                                            ></span
                                                          ><span
                                                            class="katex-4231b871f621334f"
                                                            ><span
                                                              class="pstrut katex-126b25298b406a6f"
                                                            ></span
                                                            ><span
                                                              class="mord mtight"
                                                              ><span
                                                                class="mopen mtight"
                                                                >∥</span
                                                              ><span
                                                                class="mord mathnormal mtight katex-85eed73405d3da53"
                                                                >X</span
                                                              ><span
                                                                class="mclose mtight"
                                                                ><span
                                                                  class="mclose mtight"
                                                                  >∥</span
                                                                ><span
                                                                  class="msupsub"
                                                                  ><span
                                                                    class="vlist-t vlist-t2"
                                                                    ><span
                                                                      class="vlist-r"
                                                                      ><span
                                                                        class="vlist katex-36aaa2dd3333a172"
                                                                        ><span
                                                                          class="katex-312ee5c75ee3a006"
                                                                          ><span
                                                                            class="pstrut katex-30f1852ae721d9ae"
                                                                          ></span
                                                                          ><span
                                                                            class="sizing reset-size3 size1 mtight"
                                                                            ><span
                                                                              class="mord mtight"
                                                                              >0</span
                                                                            ></span
                                                                          ></span
                                                                        ></span
                                                                      ><span
                                                                        class="vlist-s"
                                                                        >​</span
                                                                      ></span
                                                                    ><span
                                                                      class="vlist-r"
                                                                      ><span
                                                                        class="vlist katex-698887e62561da60"
                                                                        ><span></span></span></span></span></span></span
                                                              ><span
                                                                class="mrel mtight"
                                                                >=</span
                                                              ><span
                                                                class="mord mathnormal mtight"
                                                                >n</span
                                                              ></span
                                                            ></span
                                                          ></span
                                                        ><span class="vlist-s"
                                                          >​</span
                                                        ></span
                                                      ><span class="vlist-r"
                                                        ><span
                                                          class="vlist katex-99bec6bed6eb5031"
                                                          ><span></span></span></span></span></span></span></span></span></span></span
                                        ><span class="katex-48bfdc4f0cc83b58"
                                          ><span
                                            class="pstrut katex-3ac4c1d77ccd6fb1"
                                          ></span
                                          ><span
                                            ><span class="mop">min</span></span
                                          ></span
                                        ></span
                                      ><span class="vlist-s">​</span></span
                                    ><span class="vlist-r"
                                      ><span
                                        class="vlist katex-e1a788678c38bc2a"
                                        ><span></span></span></span></span></span
                                ><span
                                  class="mspace katex-b9d9edcedd93f43c"
                                ></span
                                ><span class="mopen">∥</span
                                ><span
                                  class="mord mathnormal katex-85eed73405d3da53"
                                  >X</span
                                ><span class="mclose"
                                  ><span class="mclose">∥</span
                                  ><span class="msupsub"
                                    ><span class="vlist-t vlist-t2"
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-419c46662ab8ba17"
                                          ><span class="katex-0d6ec2eaa2456336"
                                            ><span
                                              class="pstrut katex-1527d00b389b9857"
                                            ></span
                                            ><span
                                              class="sizing reset-size6 size3 mtight"
                                              ><span class="mord mtight"
                                                >2</span
                                              ></span
                                            ></span
                                          ></span
                                        ><span class="vlist-s">​</span></span
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-2506ec288336126a"
                                          ><span></span></span></span></span></span></span></span></span
                            ><span class="katex-0867eff9b8c2bf17"
                              ><span
                                class="pstrut katex-3ac4c1d77ccd6fb1"
                              ></span
                              ><span class="mord"
                                ><span class="mord mathnormal">n</span
                                ><span
                                  class="mspace katex-b9d9edcedd93f43c"
                                ></span
                                ><span class="mrel">=</span
                                ><span
                                  class="mspace katex-b9d9edcedd93f43c"
                                ></span
                                ><span class="mop op-limits"
                                  ><span class="vlist-t vlist-t2"
                                    ><span class="vlist-r"
                                      ><span
                                        class="vlist katex-a51f135ff03c83c9"
                                        ><span class="katex-777a1a2ac5ce8fb5"
                                          ><span
                                            class="pstrut katex-3ac4c1d77ccd6fb1"
                                          ></span
                                          ><span
                                            class="sizing reset-size6 size3 mtight"
                                            ><span class="mord mtight"
                                              ><span
                                                class="mord mathnormal mtight katex-87bb948d627adca1"
                                                >P</span
                                              ><span class="mrel mtight">∈</span
                                              ><span
                                                class="mord mathcal mtight katex-3ead7d987ac181e8"
                                                >P</span
                                              ></span
                                            ></span
                                          ></span
                                        ><span class="katex-48bfdc4f0cc83b58"
                                          ><span
                                            class="pstrut katex-3ac4c1d77ccd6fb1"
                                          ></span
                                          ><span
                                            ><span class="mop">min</span></span
                                          ></span
                                        ></span
                                      ><span class="vlist-s">​</span></span
                                    ><span class="vlist-r"
                                      ><span
                                        class="vlist katex-a1e803d9f293ba75"
                                        ><span></span></span></span></span></span
                                ><span
                                  class="mspace katex-b9d9edcedd93f43c"
                                ></span
                                ><span class="mopen">∥</span
                                ><span
                                  class="mord mathnormal katex-87bb948d627adca1"
                                  >P</span
                                ><span class="mclose"
                                  ><span class="mclose">∥</span
                                  ><span class="msupsub"
                                    ><span class="vlist-t vlist-t2"
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-419c46662ab8ba17"
                                          ><span class="katex-0d6ec2eaa2456336"
                                            ><span
                                              class="pstrut katex-1527d00b389b9857"
                                            ></span
                                            ><span
                                              class="sizing reset-size6 size3 mtight"
                                              ><span class="mord mtight"
                                                >0</span
                                              ></span
                                            ></span
                                          ></span
                                        ><span class="vlist-s">​</span></span
                                      ><span class="vlist-r"
                                        ><span
                                          class="vlist katex-2506ec288336126a"
                                          ><span></span></span></span></span></span></span></span></span></span
                          ><span class="vlist-s">​</span></span
                        ><span class="vlist-r"
                          ><span class="vlist katex-ce40bbd6e984816d"
                            ><span></span></span></span></span></span></span></span></span></span></span
        ></span>
      </div>
      <p>
        where we have written the problem entirely in terms of
        <span class="katex"
          ><span class="katex-mathml"
            ><math xmlns="http://www.w3.org/1998/Math/MathML"
              ><semantics
                ><mrow
                  ><msup><mi mathvariant="normal">ℓ</mi><mi>p</mi></msup></mrow
                ><annotation encoding="application/x-tex">
                  \ell^p
                </annotation></semantics
              ></math
            ></span
          ><span aria-hidden="true" class="katex-html"
            ><span class="base"
              ><span class="strut katex-1443dcef7dd0be4f"></span
              ><span class="mord"
                ><span class="mord">ℓ</span
                ><span class="msupsub"
                  ><span class="vlist-t"
                    ><span class="vlist-r"
                      ><span class="vlist katex-8727367727c49b7f"
                        ><span class="katex-00abc151c90866a2"
                          ><span class="pstrut katex-1527d00b389b9857"></span
                          ><span class="sizing reset-size6 size3 mtight"
                            ><span class="mord mathnormal mtight">p</span></span
                          ></span
                        ></span
                      ></span
                    ></span
                  ></span
                ></span
              ></span
            ></span
          ></span
        >-norms. This perspective doesn't really help when coming up with an
        efficient algorithm, but it's kind of cute.
      </p>
      <div class="page-foot">
        さみしいも、たのしい。<a
          href="https://github.com/stephen-huan/cgdct.moe/blob/master/blog/far.md"
          >Page source</a
        >. Last updated: <time datetime="2022-10-26T05:42:08">2022-10-26</time>.
      </div>
    </div>
    <!-- CONTENT ENDS HERE -->
  </body>
</html>
